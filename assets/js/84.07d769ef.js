(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{348:function(s,t,a){"use strict";a.r(t);var n=a(13),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"rocketmq基础篇"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq基础篇"}},[s._v("#")]),s._v(" RocketMQ基础篇")]),s._v(" "),a("h3",{attrs:{id:"_1-mq简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-mq简介"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_1-mq%E7%AE%80%E4%BB%8B",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("1. MQ简介")]),s._v(" "),a("h4",{attrs:{id:"_1-1-项目工程弊端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-项目工程弊端"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_1-1-%E9%A1%B9%E7%9B%AE%E5%B7%A5%E7%A8%8B%E5%BC%8A%E7%AB%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("1.1 项目工程弊端")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210227005612570.05496644.png",alt:"image-20210227005612570"}})]),s._v(" "),a("h4",{attrs:{id:"_1-2-mq简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-mq简介"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_1-2-mq%E7%AE%80%E4%BB%8B",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("1.2 MQ简介")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("MQ（Message Queue）消息队列，是一种用来保存消息数据的队列.")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("队列：数据结构的一种，特征为 “先进先出”")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210227005644041.049e2350.png",alt:"image-20210227005644041"}})])]),s._v(" "),a("li",[a("p",[s._v("何为消息")]),s._v(" "),a("ol",[a("li",[s._v("服务器间的业务请求\n"),a("ol",[a("li",[s._v("原始架构：\n"),a("ol",[a("li",[s._v("服务器中的A功能需要调用B、C模块才能完成")])])]),s._v(" "),a("li",[s._v("微服务架构：\n"),a("ol",[a("li",[s._v("服务器A向服务器B发送要执行的操作（视为消息）")]),s._v(" "),a("li",[s._v("服务器A向服务器C发送要执行的操作（视为消息）")])])])])])])])])]),s._v(" "),a("li",[a("p",[s._v("小节:MQ概念")])])]),s._v(" "),a("h4",{attrs:{id:"_1-3-mq作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-mq作用"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_1-3-mq%E4%BD%9C%E7%94%A8",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("1.3 MQ作用")]),s._v(" "),a("p",[s._v("优势：")]),s._v(" "),a("ul",[a("li",[s._v("应用解耦")]),s._v(" "),a("li",[s._v("异步提速")]),s._v(" "),a("li",[s._v("削峰填谷")])]),s._v(" "),a("p",[s._v("劣势：")]),s._v(" "),a("ul",[a("li",[s._v("系统可用性降低")]),s._v(" "),a("li",[s._v("系统复杂度提高")]),s._v(" "),a("li",[s._v("一致性问题")])]),s._v(" "),a("h4",{attrs:{id:"_1-4-mq基本工作模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-mq基本工作模式"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_1-4-mq%E5%9F%BA%E6%9C%AC%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("1.4 MQ基本工作模式")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210227011631473.cb178ec3.png",alt:"image-20210227011631473"}})]),s._v(" "),a("p",[s._v("应用解耦:（异步消息发送）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210227011703071.844da7b4.png",alt:"image-20210227011703071"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210227011721338.f6d6ce2a.png",alt:"image-20210227011721338"}})]),s._v(" "),a("p",[s._v("流量削锋:（异步消息发送）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210227012322129.823cdf25.png",alt:"image-20210227012322129"}})]),s._v(" "),a("h4",{attrs:{id:"_1-5-mq优缺点分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-mq优缺点分析"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_1-5-mq%E4%BC%98%E7%BC%BA%E7%82%B9%E5%88%86%E6%9E%90",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("1.5 MQ优缺点分析")]),s._v(" "),a("p",[s._v("优点（作用）:")]),s._v(" "),a("ol",[a("li",[s._v("应用解耦")]),s._v(" "),a("li",[s._v("快速应用变更维护")]),s._v(" "),a("li",[s._v("流量削锋")])]),s._v(" "),a("p",[s._v("缺点:")]),s._v(" "),a("ol",[a("li",[s._v("系统可用性降低")]),s._v(" "),a("li",[s._v("系统复杂度提高")]),s._v(" "),a("li",[s._v("异步消息机制\n"),a("ol",[a("li",[s._v("消息顺序性")]),s._v(" "),a("li",[s._v("消息丢失")]),s._v(" "),a("li",[s._v("消息一致性")]),s._v(" "),a("li",[s._v("消息重复使用")])])])]),s._v(" "),a("h4",{attrs:{id:"_1-6-mq产品介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-mq产品介绍"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_1-6-mq%E4%BA%A7%E5%93%81%E4%BB%8B%E7%BB%8D",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("1.6 MQ产品介绍")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("ActiveMQ")]),s._v(" "),a("p",[s._v("java语言实现，万级数据吞吐量，处理速度ms级，主从架构，"),a("strong",[s._v("成熟度高")])])]),s._v(" "),a("li",[a("p",[s._v("RabbitMQ")]),s._v(" "),a("p",[a("strong",[s._v("erlang语言实现")]),s._v("，万级数据吞吐量，"),a("strong",[s._v("处理速度us级")]),s._v("，主从架构，")])]),s._v(" "),a("li",[a("p",[s._v("RocketMQ")]),s._v(" "),a("p",[s._v("java语言实现，"),a("strong",[s._v("十万级")]),s._v("数据吞吐量，处理速度ms级，分布式架构，功能强大，扩展性强")])]),s._v(" "),a("li",[a("p",[s._v("kafka")]),s._v(" "),a("p",[s._v("scala语言实现，"),a("strong",[s._v("十万级")]),s._v("数据吞吐量，处理速度ms级，分布式架构，功能较少，应用于大数据较多")])])]),s._v(" "),a("p",[a("strong",[s._v("RocketMQ")])]),s._v(" "),a("ol",[a("li",[s._v("RocketMQ是阿里开源的一款非常优秀中间件产品，脱胎于阿里的另一款队列技术MetaQ，后捐赠给"),a("strong",[s._v("Apache")]),s._v("基金会 作为一款孵化技术，仅仅经历了一年多的时间就成为Apache基金会的顶级项目。并且它现在已经在阿里内部被广泛 的应用，并且经受住了多次双十一的这种极致场景的压力（2017年的双十一，RocketMQ流转的消息量达到了万亿 级，峰值TPS达到5600万）")]),s._v(" "),a("li",[s._v("解决所有缺点")])]),s._v(" "),a("h3",{attrs:{id:"_2-环境搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-环境搭建"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_2-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("2. 环境搭建")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211151842484.8d7fe268.png",alt:"image-20201211151842484"}})]),s._v(" "),a("h4",{attrs:{id:"_2-1-基础概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-基础概念"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_2-1-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("2.1 基础概念")]),s._v(" "),a("ol",[a("li",[s._v("生产者")]),s._v(" "),a("li",[s._v("消费者")]),s._v(" "),a("li",[s._v("消息服务器")]),s._v(" "),a("li",[s._v("命名服务器")]),s._v(" "),a("li",[s._v("消息\n"),a("ol",[a("li",[s._v("主题")]),s._v(" "),a("li",[s._v("标签")])])]),s._v(" "),a("li",[s._v("心跳")]),s._v(" "),a("li",[s._v("监听器")]),s._v(" "),a("li",[s._v("拉取消费、推动消费")]),s._v(" "),a("li",[s._v("注册")])]),s._v(" "),a("h4",{attrs:{id:"_2-2-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-安装"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_2-2-%E5%AE%89%E8%A3%85",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("2.2 安装")]),s._v(" "),a("ol",[a("li",[s._v("命名服务器")]),s._v(" "),a("li",[s._v("消息服务器")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211152332969.5ba50bce.png",alt:"image-20201211152332969"}})]),s._v(" "),a("h4",{attrs:{id:"_2-3-下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-下载"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_2-3-%E4%B8%8B%E8%BD%BD",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("2.3 下载")]),s._v(" "),a("p",[s._v("⚫ https://www.apache.org/")]),s._v(" "),a("h4",{attrs:{id:"_2-4-linux安装过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-linux安装过程"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_2-4-linux%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("2.4 linux安装过程")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("步骤1：安装JDK（1.8）")])]),s._v(" "),a("li",[a("p",[s._v("步骤2：上传压缩包（zip）")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v("yum -y install lrzsz \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")])]),s._v(" "),a("li",[a("p",[s._v("步骤3：解压缩")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("unzip rocketmq-all-4.5.2-bin-release.zip\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")])]),s._v(" "),a("li",[a("p",[s._v("步骤4：修改目录名称")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mv rocketmq-all-4.5.2-bin-release rocketmq\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")])])]),s._v(" "),a("p",[a("strong",[s._v("启动服务器")])]),s._v(" "),a("ol",[a("li",[s._v("步骤1：启动命名服务器（bin目录下）")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sh mqnamesrv\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("步骤2：启动消息服务器（bin目录下）")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sh mqbroker -n localhost:9876\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[s._v("修改runbroker.sh文件中有关内存的配置（调整的与当前虚拟机内存匹配即可，推荐256m-128m）")])])]),s._v(" "),a("p",[a("strong",[s._v("测试服务器环境")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("步骤1：配置命名服务器地址")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v("export NAMESRV_ADDR=localhost:9876\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")])]),s._v(" "),a("li",[a("p",[s._v("步骤2：启动生产者程序客户端（bin目录下）")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sh tools.sh org.apache.rocketmq.example.quickstart.Producer\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[s._v("启动后产生大量日志信息（注意该信息是测试程序中自带的，不具有通用性，仅供学习查阅参考）")])]),s._v(" "),a("li",[a("p",[s._v("步骤3：启动消费者程序客户端（bin目录下）")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sh tools.sh org.apache.rocketmq.example.quickstart.Consumer\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[s._v("启动后产生大量日志信息")])])]),s._v(" "),a("h4",{attrs:{id:"_2-5-windows安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-windows安装"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_2-5-windows%E5%AE%89%E8%A3%85",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("2.5 windows安装")]),s._v(" "),a("h5",{attrs:{id:"_2-5-1系统环境变量配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-1系统环境变量配置"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_2-5-1%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("2.5.1"),a("strong",[s._v("系统环境变量配置")])]),s._v(" "),a("p",[s._v("1、右键我的电脑--\x3e属性")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210216112544747.73835ac5.png",alt:"image-20210216112544747"}})]),s._v(" "),a("p",[s._v("2、系统属性--环境变量")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210216112631558.7e29712b.png",alt:"image-20210216112631558"}})]),s._v(" "),a("p",[s._v("3、系统变量中--\x3e新建")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210216112735780.a6597055.png",alt:"image-20210216112735780"}})]),s._v(" "),a("p",[s._v("变量名：ROCKETMQ_HOME")]),s._v(" "),a("p",[s._v("变量值：MQ解压路径\\MQ文件夹名")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210216112826156.50ae15d0.png",alt:"image-20210216112826156"}})]),s._v(" "),a("h5",{attrs:{id:"_2-5-2启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-2启动"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_2-5-2%E5%90%AF%E5%8A%A8",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("2.5.2"),a("strong",[s._v("启动")])]),s._v(" "),a("p",[s._v("1、"),a("strong",[s._v("启动NAMESERVER")])]),s._v(" "),a("p",[s._v("Cmd命令框执行进入至‘MQ文件夹\\bin’下 端口9876")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("start mqnamesrv.cmd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210216110141279.99db0625.png",alt:"image-20210216110141279"}})]),s._v(" "),a("p",[s._v("2、"),a("strong",[s._v("启动BROKER")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("start mqbroker.cmd -n 127.0.0.1:9876 autoCreateTopicEnable=true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210216111405243.60f804d4.png",alt:"image-20210216111405243"}})]),s._v(" "),a("p",[a("strong",[s._v("注意")]),s._v("：闪退回命令行")]),s._v(" "),a("p",[s._v("删除C:\\Users\\”当前系统用户名”\\store下的所有文件。")]),s._v(" "),a("h5",{attrs:{id:"_2-5-3测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-3测试"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_2-5-3%E6%B5%8B%E8%AF%95",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("2.5.3"),a("strong",[s._v("测试")])]),s._v(" "),a("p",[s._v("1、"),a("strong",[s._v("新建环境变量")])]),s._v(" "),a("p",[s._v("变量名：NAMESRV_ADDR")]),s._v(" "),a("p",[s._v("变量值：localhost:9876")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210216112924986.d254a99f.png",alt:"image-20210216112924986"}})]),s._v(" "),a("p",[s._v("2、测试生产者发送消息")]),s._v(" "),a("p",[s._v("bin目录下")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("tools.cmd  org.apache.rocketmq.example.quickstart.Producer\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[s._v("3、测试消费者接收消息")]),s._v(" "),a("p",[s._v("bin目录下")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("tools.cmd org.apache.rocketmq.example.quickstart.Consumer\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("h5",{attrs:{id:"_2-5-4控制台安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-4控制台安装"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_2-5-4%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%AE%89%E8%A3%85",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("2.5.4控制台安装")]),s._v(" "),a("p",[s._v("1下载源码")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("git clone https://github.com/apache/rocketmq-externals.git\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[s._v("2进入rocketmq-externals\\rocketmq-console 工程，编译源码")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mvn clean package -Dmaven.test.skip=true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[s._v("3target 目录生成 jar包")]),s._v(" "),a("p",[s._v("4运行")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("java -jar rocketmq-console-ng-2.0.0.jar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[s._v("5访问 http://localhost:8080/#/")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210216174310729.6bcf3969.png",alt:"image-20210216174310729"}})]),s._v(" "),a("h3",{attrs:{id:"_3-消息发送-重点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-消息发送-重点"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81-%E9%87%8D%E7%82%B9",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3. 消息发送（重点）")]),s._v(" "),a("h4",{attrs:{id:"_3-1-主要内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-主要内容"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-1-%E4%B8%BB%E8%A6%81%E5%86%85%E5%AE%B9",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3.1 主要内容")]),s._v(" "),a("ol",[a("li",[s._v("基于Java环境构建消息发送与消息接收基础程序\n"),a("ol",[a("li",[s._v("单生产者单消费者")]),s._v(" "),a("li",[s._v("单生产者多消费者")]),s._v(" "),a("li",[s._v("多生产者多消费者")])])]),s._v(" "),a("li",[s._v("发送不同类型的消息\n"),a("ol",[a("li",[s._v("同步消息")]),s._v(" "),a("li",[s._v("异步消息")]),s._v(" "),a("li",[s._v("单向消息")])])]),s._v(" "),a("li",[s._v("特殊的消息发送\n"),a("ol",[a("li",[s._v("延时消息")]),s._v(" "),a("li",[s._v("批量消息")])])]),s._v(" "),a("li",[s._v("特殊的消息接收\n"),a("ol",[a("li",[s._v("消息过滤")])])]),s._v(" "),a("li",[s._v("消息发送与接收顺序控制")]),s._v(" "),a("li",[s._v("事务消息")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211153150220.212d1185.png",alt:"image-20201211153150220"}})]),s._v(" "),a("h4",{attrs:{id:"_3-2-消息发送与接收开发流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-消息发送与接收开发流程"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-2-%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E4%B8%8E%E6%8E%A5%E6%94%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3.2 消息发送与接收开发流程")]),s._v(" "),a("ol",[a("li",[s._v("谁来发？")]),s._v(" "),a("li",[s._v("发给谁？")]),s._v(" "),a("li",[s._v("怎么发？")]),s._v(" "),a("li",[s._v("发什么？")]),s._v(" "),a("li",[s._v("发的结果是什么？")]),s._v(" "),a("li",[s._v("打扫战场")])]),s._v(" "),a("h4",{attrs:{id:"_3-3-单生产者单消费者消息发送-onetoone"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-单生产者单消费者消息发送-onetoone"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-3-%E5%8D%95%E7%94%9F%E4%BA%A7%E8%80%85%E5%8D%95%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81-onetoone",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3.3 单生产者单消费者消息发送（OneToOne）")]),s._v(" "),a("p",[s._v("1新建maven项目rocketmq")]),s._v(" "),a("p",[s._v("2导入RocketMQ客户端坐标")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.apache.rocketmq"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("rocketmq-client"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("4.8.0"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5")]),s._v(" "),a("p",[s._v("3生产者 com.ydl.base.Producer")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ydl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("base")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exception"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MQClientException")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQProducer")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SendResult")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("common"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Producer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n         1. 谁来发？\n         2. 发给谁？\n         3. 怎么发？\n         4. 发什么？\n         5. 发的结果是什么？\n         6. 打扫战场\n         **/")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1.创建一个发送消息的对象Producer")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQProducer")]),s._v(" producer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQProducer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2.设定发送的命名服务器地址")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setNamesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9876"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.1启动发送的服务")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//4.创建要发送的消息对象,指定topic，指定内容body")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello rocketmq"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.2发送消息")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SendResult")]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"返回结果："')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//5.关闭连接")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("p",[s._v("4消费者")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ydl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("base")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQPushConsumer")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("listener"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeConcurrentlyContext")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("listener"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeConcurrentlyStatus")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("listener"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageListenerConcurrently")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exception"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MQClientException")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("common"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Consumer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n         1. 谁来发？\n         2. 发给谁？\n         3. 怎么发？\n         4. 发什么？\n         5. 发的结果是什么？\n         6. 打扫战场\n         **/")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1.创建一个接收消息的对象Consumer")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQPushConsumer")]),s._v(" consumer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQPushConsumer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2.设定接收的命名服务器地址")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setNamesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9876"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.设置接收消息对应的topic,对应的sub标签为任意")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.开启监听，用于接收消息")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("registerMessageListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageListenerConcurrently")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeConcurrentlyStatus")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("consumeMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeConcurrentlyContext")]),s._v(" consumeConcurrentlyContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//遍历消息")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"收到消息："')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeConcurrentlyStatus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CONSUME_SUCCESS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//4.启动接收消息的服务")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"接受消息服务已经开启！"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//5 不要关闭消费者！")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45")]),s._v(" "),a("h4",{attrs:{id:"_3-4-单生产者多消费者消息发送-onetomany"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-单生产者多消费者消息发送-onetomany"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-4-%E5%8D%95%E7%94%9F%E4%BA%A7%E8%80%85%E5%A4%9A%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81-onetomany",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3.4 单生产者多消费者消息发送（OneToMany）")]),s._v(" "),a("p",[a("strong",[s._v("1生产者")]),s._v(" com.ydl.one2many.Producer")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1.创建一个发送消息的对象Producer")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQProducer")]),s._v(" producer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQProducer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2.设定发送的命名服务器地址")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setNamesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9876"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.1启动发送的服务")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//4.创建要发送的消息对象,指定topic，指定内容body")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello rocketmq"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.2发送消息")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SendResult")]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"返回结果："')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//5.关闭连接")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15")]),s._v(" "),a("p",[a("strong",[s._v("2消费者")]),s._v("（负载均衡模式：默认模式）")]),s._v(" "),a("p",[s._v("开启多实例运行")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210216122333256.5ba41b96.png",alt:"image-20210216122333256"}})]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1.创建一个接收消息的对象Consumer")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQPushConsumer")]),s._v(" consumer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQPushConsumer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2.设定接收的命名服务器地址")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setNamesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9876"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.设置接收消息对应的topic,对应的sub标签为任意")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置当前消费者的消费模式（默认模式：负载均衡）")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMessageModel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageModel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLUSTERING")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.开启监听，用于接收消息")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("registerMessageListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageListenerConcurrently")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeConcurrentlyStatus")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("consumeMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeConcurrentlyContext")]),s._v(" consumeConcurrentlyContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//遍历消息")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"收到消息："')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"消息是："')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBody")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeConcurrentlyStatus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CONSUME_SUCCESS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//4.启动接收消息的服务")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"接受消息服务已经开启！"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//5 不要关闭消费者！")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25")]),s._v(" "),a("p",[s._v("注意：同一个消费者 多份。争抢topic数据。")]),s._v(" "),a("h4",{attrs:{id:"_3-5-单生产者多消费者消息发送-onetomany"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-单生产者多消费者消息发送-onetomany"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-5-%E5%8D%95%E7%94%9F%E4%BA%A7%E8%80%85%E5%A4%9A%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81-onetomany",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3.5 单生产者多消费者消息发送（OneToMany）")]),s._v(" "),a("p",[s._v("消费者（广播模式）")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1.创建一个接收消息的对象Consumer")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQPushConsumer")]),s._v(" consumer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQPushConsumer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2.设定接收的命名服务器地址")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setNamesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9876"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.设置接收消息对应的topic,对应的sub标签为任意")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置当前消费者的消费模式（默认模式：负载均衡）")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//consumer.setMessageModel(MessageModel.CLUSTERING);")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置当前消费者的消费模式（广播模式）")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMessageModel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageModel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BROADCASTING")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.开启监听，用于接收消息")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("registerMessageListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageListenerConcurrently")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeConcurrentlyStatus")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("consumeMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeConcurrentlyContext")]),s._v(" consumeConcurrentlyContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//遍历消息")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"收到消息："')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"消息是："')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBody")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeConcurrentlyStatus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CONSUME_SUCCESS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//4.启动接收消息的服务")]),s._v("\n        consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"接受消息服务已经开启！"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//5 不要关闭消费者！")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27")]),s._v(" "),a("h4",{attrs:{id:"_3-6-多生产者多消费者消息发送-manytomany"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-多生产者多消费者消息发送-manytomany"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-6-%E5%A4%9A%E7%94%9F%E4%BA%A7%E8%80%85%E5%A4%9A%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81-manytomany",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3.6 多生产者多消费者消息发送（ManyToMany）")]),s._v(" "),a("ol",[a("li",[s._v("多生产者产生的消息可以被同一个消费者消费，也可以被多个消费者消费")])]),s._v(" "),a("h4",{attrs:{id:"_3-7-小节"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-小节"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-7-%E5%B0%8F%E8%8A%82",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3.7 小节")]),s._v(" "),a("ol",[a("li",[s._v("消息发送\n"),a("ol",[a("li",[s._v("One-To-One（基础发送与基础接收）")]),s._v(" "),a("li",[s._v("One-To-Many（负载均衡模式与广播模式）")]),s._v(" "),a("li",[s._v("Many-To-Many")])])])]),s._v(" "),a("h3",{attrs:{id:"_4-消息类别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-消息类别"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_4-%E6%B6%88%E6%81%AF%E7%B1%BB%E5%88%AB",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("4 消息类别")]),s._v(" "),a("ol",[a("li",[s._v("同步消息")]),s._v(" "),a("li",[s._v("异步消息")]),s._v(" "),a("li",[s._v("单向消息")])]),s._v(" "),a("h4",{attrs:{id:"_4-1-同步消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-同步消息"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_4-1-%E5%90%8C%E6%AD%A5%E6%B6%88%E6%81%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("4.1 同步消息")]),s._v(" "),a("p",[s._v("特征：即时性较强，重要的消息，且必须有回执的消息，例如短信，通知（转账成功）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211154023471.76f3f927.png",alt:"image-20201211154023471"}})]),s._v(" "),a("p",[s._v("代码实现")]),s._v(" "),a("p",[s._v("com.ydl.messageType拷贝producer")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SendResult")]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("h4",{attrs:{id:"_4-2-异步消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-异步消息"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_4-2-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("4.2 异步消息")]),s._v(" "),a("p",[s._v("特征：即时性较弱，但需要有回执的消息，例如订单中的某些信息")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211154108518.8c569153.png",alt:"image-20201211154108518"}})]),s._v(" "),a("p",[s._v("代码实现")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1.创建一个发送消息的对象Producer")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQProducer")]),s._v(" producer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQProducer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2.设定发送的命名服务器地址")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setNamesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9876"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.1启动发送的服务")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//4.创建要发送的消息对象,指定topic，指定内容body")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello rocketmq"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.2 同步消息")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//SendResult result = producer.send(msg);")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//System.out.println("返回结果：" + result);')]),s._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//异步消息")]),s._v("\n            producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SendCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//表示成功返回结果")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("onSuccess")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SendResult")]),s._v(" sendResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sendResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//表示发送消息失败")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("onException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" throwable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("throwable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            \n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"消息"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"发完了，做业务逻辑去了！"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//休眠10秒")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//5.关闭连接")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33")]),s._v(" "),a("h4",{attrs:{id:"_4-3-单向消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-单向消息"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_4-3-%E5%8D%95%E5%90%91%E6%B6%88%E6%81%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("4.3 单向消息")]),s._v(" "),a("p",[s._v("特征：不需要有回执的消息，例如日志类消息")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211154145199.61ef2761.png",alt:"image-20201211154145199"}})]),s._v(" "),a("p",[s._v("代码实现")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendOneway")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("h4",{attrs:{id:"_4-4-延时消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-延时消息"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_4-4-%E5%BB%B6%E6%97%B6%E6%B6%88%E6%81%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("4.4 延时消息")]),s._v(" "),a("p",[s._v("消息发送时并不直接发送到消息服务器，而是根据设定的等待时间到达，起到延时到达的缓冲作用")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"延时消息：hello rocketmq "')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置延时等级3,这个消息将在10s之后发送(现在只支持固定的几个时间,详看delayTimeLevel)")]),s._v("\nmsg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDelayTimeLevel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SendResult")]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"返回结果："')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5")]),s._v(" "),a("p",[s._v("目前支持的消息时间")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" messageDelayLevel "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("h4",{attrs:{id:"_4-5-批量消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-批量消息"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_4-5-%E6%89%B9%E9%87%8F%E6%B6%88%E6%81%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("4.5 批量消息")]),s._v(" "),a("p",[s._v("批量发送消息能显著提高传递小消息的性能.")]),s._v(" "),a("p",[s._v("发送批量消息:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" msgList "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello rocketmq1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello rocketmq2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello rocketmq3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        msgList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        msgList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        msgList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SendResult")]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msgList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11")]),s._v(" "),a("p",[a("strong",[s._v("注意限制")]),s._v("：")]),s._v(" "),a("p",[s._v("1这些批量消息应该有相同的topic")]),s._v(" "),a("p",[s._v("2相同的waitStoreMsgOK")]),s._v(" "),a("p",[s._v("3不能是延时消息")]),s._v(" "),a("p",[s._v("4消息内容总长度不超过4M")]),s._v(" "),a("p",[s._v("消息内容总长度包含如下：")]),s._v(" "),a("ul",[a("li",[s._v("topic（字符串字节数）")]),s._v(" "),a("li",[s._v("body （字节数组长度）")]),s._v(" "),a("li",[s._v("消息追加的属性（key与value对应字符串字节数）")]),s._v(" "),a("li",[s._v("日志（固定20字节）")])]),s._v(" "),a("h4",{attrs:{id:"_4-6-消息过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-消息过滤"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_4-6-%E6%B6%88%E6%81%AF%E8%BF%87%E6%BB%A4",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("4.6 消息过滤")]),s._v(" "),a("h5",{attrs:{id:"_4-6-1分类过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-1分类过滤"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_4-6-1%E5%88%86%E7%B1%BB%E8%BF%87%E6%BB%A4",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("4.6.1分类过滤")]),s._v(" "),a("p",[s._v("按照tag过滤信息。")]),s._v(" "),a("p",[a("strong",[s._v("生产者")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tag2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"消息过滤按照tag：hello rocketmq 2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[a("strong",[s._v("消费者")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//接收消息的时候，除了制定topic，还可以指定接收的tag,*代表任意tag")]),s._v("\nconsumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tag1 || tag2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("1\n2")]),s._v(" "),a("h5",{attrs:{id:"_4-6-2语法过滤-属性过滤-语法过滤-sql过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-2语法过滤-属性过滤-语法过滤-sql过滤"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_4-6-2%E8%AF%AD%E6%B3%95%E8%BF%87%E6%BB%A4-%E5%B1%9E%E6%80%A7%E8%BF%87%E6%BB%A4-%E8%AF%AD%E6%B3%95%E8%BF%87%E6%BB%A4-sql%E8%BF%87%E6%BB%A4",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("4.6.2语法过滤（属性过滤/语法过滤/SQL过滤）")]),s._v(" "),a("p",[s._v("基本语法")]),s._v(" "),a("ul",[a("li",[s._v("数值比较，比如："),a("strong",[s._v(">，>=，<，<=，BETWEEN，=；")])]),s._v(" "),a("li",[s._v("字符比较，比如："),a("strong",[s._v("=，<>，IN；")])]),s._v(" "),a("li",[a("strong",[s._v("IS NULL")]),s._v(" 或者 "),a("strong",[s._v("IS NOT NULL；")])]),s._v(" "),a("li",[s._v("逻辑符号 "),a("strong",[s._v("AND，OR，NOT；")])])]),s._v(" "),a("p",[s._v("常量支持类型为：")]),s._v(" "),a("ul",[a("li",[s._v("数值，比如："),a("strong",[s._v("123，3.1415；")])]),s._v(" "),a("li",[s._v("字符，比如："),a("strong",[s._v("'abc'，必须用单引号包裹起来；")])]),s._v(" "),a("li",[a("strong",[s._v("NULL")]),s._v("，特殊的常量")]),s._v(" "),a("li",[s._v("布尔值，"),a("strong",[s._v("TRUE")]),s._v(" 或 "),a("strong",[s._v("FALSE")])])]),s._v(" "),a("p",[a("strong",[s._v("生产者")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//为消息添加属性")]),s._v("\nmsg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("putUserProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vip"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmsg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("putUserProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"20"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("1\n2\n3")]),s._v(" "),a("p",[a("strong",[s._v("消费者")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//使用消息选择器来过滤对应的属性，语法格式为类SQL语法")]),s._v("\nconsumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic7"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bySql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age >= 18"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bySql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"name = 'litiedan'\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("1\n2\n3")]),s._v(" "),a("p",[a("strong",[s._v("注意")]),s._v("：SQL过滤需要依赖服务器的功能支持，在broker.conf配置文件中添加对应的功能项，并开启对应功能")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("enablePropertyFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[s._v("重启broker")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("start mqbroker.cmd -n 127.0.0.1:9876 autoCreateTopicEnable=true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[s._v("或者直接cmd中输入")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mqadmin.cmd updateBrokerConfig -blocalhost:10911 -kenablePropertyFilter -vtrue\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[s._v("页面查看开启与否")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210216175129980.81f41d00.png",alt:"image-20210216175129980"}})]),s._v(" "),a("h3",{attrs:{id:"_5springboot整合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5springboot整合"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5springboot%E6%95%B4%E5%90%88",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5springboot整合")]),s._v(" "),a("p",[s._v("新建 springboot项目")]),s._v(" "),a("h4",{attrs:{id:"_5-1导包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1导包"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-1%E5%AF%BC%E5%8C%85",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.1导包")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" \t&lt;dependency>\n        &lt;groupId>org.apache.rocketmq&lt;/groupId>\n        &lt;artifactId>rocketmq-spring-boot-starter&lt;/artifactId>\n        &lt;version>2.0.3&lt;/version>\n    &lt;/dependency>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5")]),s._v(" "),a("h4",{attrs:{id:"_5-2配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2配置文件"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-2%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.2配置文件")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rocketmq.name-server=localhost:9876\nrocketmq.producer.group=demo_producer\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("1\n2")]),s._v(" "),a("h4",{attrs:{id:"_5-3实体类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3实体类"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-3%E5%AE%9E%E4%BD%93%E7%B1%BB",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.3实体类")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("public class user implements Serializable {\n    String userName;\n    String userId;\n\n    public user(){\n\n    }\n\n    public user(String userName, String userId) {\n        this.userName = userName;\n        this.userId = userId;\n    }\n\n    @Override\n    public String toString() {\n        return \"demoEntity{\" +\n                \"userName='\" + userName + '\\'' +\n                \", userId='\" + userId + '\\'' +\n                '}';\n    }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20")]),s._v(" "),a("h4",{attrs:{id:"_5-4生产者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4生产者"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-4%E7%94%9F%E4%BA%A7%E8%80%85",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.4生产者")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('@RestController\npublic class DemoProducers {\n    @Autowired\n    private RocketMQTemplate template;\n\n    @RequestMapping("/producer")\n    public String producersMessage() {\n        User user = new User("sharfine", "123456789");\n        template.convertAndSend("demo-topic", user);\n        return JSON.toJSONString(user);\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12")]),s._v(" "),a("h4",{attrs:{id:"_5-5消费者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5消费者"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-5%E6%B6%88%E8%B4%B9%E8%80%85",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.5消费者")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('@Service\n@RocketMQMessageListener(topic = "demo-topic", consumerGroup = "demo_consumer")\npublic class DemoConsumers1 implements RocketMQListener&lt;user> {\n    @Override\n    public void onMessage(user user) {\n        System.out.println("Consumers1接收消息:" + demoEntity.toString());\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8")]),s._v(" "),a("h4",{attrs:{id:"_5-6其他消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-6其他消息"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-6%E5%85%B6%E4%BB%96%E6%B6%88%E6%81%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.6其他消息")]),s._v(" "),a("p",[a("strong",[s._v("异步发送")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('       rocketMQTemplate.asyncSend("topic9", user, new SendCallback() {\n            @Override\n            public void onSuccess(SendResult sendResult) {\n                System.out.println(sendResult);\n            }\n\n            @Override\n            public void onException(Throwable throwable) {\n                System.out.println(throwable);\n            }\n        });\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12")]),s._v(" "),a("p",[a("strong",[s._v("单向发送")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('rocketMQTemplate.sendOneWay("topic9",user);\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[a("strong",[s._v("延时消息")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('rocketMQTemplate.syncSend("topic9", MessageBuilder.withPayload("test delay").build(),2000,2);\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[a("strong",[s._v("批量")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('List&lt;Message> msgList = new ArrayList&lt;>();\nmsgList.add(new Message("topic6", "tag1", "msg1".getBytes()));\nmsgList.add(new Message("topic6", "tag1", "msg2".getBytes()));\nmsgList.add(new Message("topic6", "tag1", "msg3".getBytes()));        rocketMQTemplate.syncSend("topic8",msgList,1000);\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("1\n2\n3\n4")]),s._v(" "),a("p",[a("strong",[s._v("Tag过滤")])]),s._v(" "),a("p",[s._v("消费者")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('@RocketMQMessageListener(topic = "topic9",consumerGroup = "group1",selectorExpression = "tag1")\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("p",[s._v("Sql过滤")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('@RocketMQMessageListener(topic = "topic9",consumerGroup = "group1",selectorExpression = "age>18"\n        ,selectorType= SelectorType.SQL92)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("1\n2")]),s._v(" "),a("p",[s._v("改消息模式")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('@RocketMQMessageListener(topic = "topic9",consumerGroup = "group1",messageModel = MessageModel.BROADCASTING)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("h2",{attrs:{id:"rocketmq-进阶篇"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq-进阶篇"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#rocketmq-%E8%BF%9B%E9%98%B6%E7%AF%87",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("RocketMQ 进阶篇")]),s._v(" "),a("h3",{attrs:{id:"_1消息的特殊处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1消息的特殊处理"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_1%E6%B6%88%E6%81%AF%E7%9A%84%E7%89%B9%E6%AE%8A%E5%A4%84%E7%90%86",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("1消息的特殊处理")]),s._v(" "),a("h4",{attrs:{id:"_1-1-错乱的消息顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-错乱的消息顺序"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_1-1-%E9%94%99%E4%B9%B1%E7%9A%84%E6%B6%88%E6%81%AF%E9%A1%BA%E5%BA%8F",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("1.1 错乱的消息顺序")]),s._v(" "),a("p",[s._v("原因")]),s._v(" "),a("p",[s._v("消息有序指的是可以按照消息的发送顺序来消费(FIFO)。RocketMQ可以严格的保证消息有序，可以分为分区有序或者全局有序。")]),s._v(" "),a("p",[s._v("顺序消费的原理解析，在默认的情况下消息发送会采取Round Robin轮询方式把消息发送到不同的queue(分区队列)；而消费消息的时候从多个queue上拉取消息，这种情况发送和消费是不能保证顺序。但是如果控制发送的顺序消息只依次发送到同一个queue中，消费的时候只从这个queue上依次拉取，则就保证了顺序。当发送和消费参与的queue只有一个，则是全局有序；如果多个queue参与，则为分区有序，即相对每个queue，消息都是有序的。")]),s._v(" "),a("p",[s._v("下面用订单进行分区有序的示例。一个订单的顺序流程是：创建、付款、推送、完成。订单号相同的消息会被先后发送到同一个队列中，消费时，同一个OrderId获取到的肯定是同一个队列。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210227193832410.dd83739c.png",alt:"image-20210227193832410"}})]),s._v(" "),a("p",[s._v("先读到第一个订单的创建和完成消息")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210227193914094.155711c3.png",alt:"image-20210227193914094"}})]),s._v(" "),a("p",[s._v("想要的效果")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210227194435616.4d9e4f37.png",alt:"image-20210227194435616"}})]),s._v(" "),a("h4",{attrs:{id:"_1-2-顺序消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-顺序消息"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_1-2-%E9%A1%BA%E5%BA%8F%E6%B6%88%E6%81%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("1.2 顺序消息")]),s._v(" "),a("p",[s._v("1.2.1订单步骤实体类")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("package com.ydl.order.domain;\n\n/**\n * 订单的步骤\n */\npublic class OrderStep {\n    private long orderId;\n    private String desc;\n\n    public long getOrderId() {\n        return orderId;\n    }\n\n    public void setOrderId(long orderId) {\n        this.orderId = orderId;\n    }\n\n    public String getDesc() {\n        return desc;\n    }\n\n    public void setDesc(String desc) {\n        this.desc = desc;\n    }\n\n    @Override\n    public String toString() {\n        return \"OrderStep{\" +\n                \"orderId=\" + orderId +\n                \", desc='\" + desc + '\\'' +\n                '}';\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34")]),s._v(" "),a("p",[s._v("1.2.1发送消息")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ydl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("order")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ydl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("order"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQProducer")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageQueueSelector")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SendResult")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("common"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("common"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageQueue")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SimpleDateFormat")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Producer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQProducer")]),s._v(" producer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultMQProducer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setNamesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9876"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" orderList "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Producer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("buildOrders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置消息进入到指定的消息队列中")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),s._v(" order "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" orderList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" order"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//发送时要指定对应的消息队列选择器")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SendResult")]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageQueueSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置当前消息发送时使用哪一个消息队列")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageQueue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("select")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//根据发送的信息不同，选择不同的消息队列")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//根据id来选择一个消息队列的对象，并返回->id得到int值")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" orderId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" order"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getOrderId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" mqIndex "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" orderId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" mqIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//for (int i = 0; i < 10; i++) {")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//    Message msg = new Message("topic1", ("hello rocketmq"+i).getBytes("UTF-8"));')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//    SendResult result = producer.send(msg);")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//    System.out.println("返回结果：" + result);')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 生成模拟订单数据\n     */")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("buildOrders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" orderList "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),s._v(" orderDemo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setOrderId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDesc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"创建"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        orderDemo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setOrderId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDesc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"创建"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        orderDemo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setOrderId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDesc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"付款"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        orderDemo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setOrderId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDesc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"创建"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        orderDemo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setOrderId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDesc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"付款"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        orderDemo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setOrderId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDesc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"付款"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        orderDemo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setOrderId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDesc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"完成"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        orderDemo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setOrderId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDesc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"推送"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        orderDemo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setOrderId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDesc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"完成"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        orderDemo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderStep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setOrderId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDesc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"完成"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        orderList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderDemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" orderList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109")]),s._v(" "),a("p",[s._v("1.2.2接收消息")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//使用单线程的模式从消息队列中取数据，一个线程绑定一个消息队列")]),s._v("\n\t\tconsumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("registerMessageListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageListenerOrderly")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//使用MessageListenerOrderly接口后，对消息队列的处理由一个消息队列多个线程服务，转化为一个消息队列一个线程服务")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeOrderlyStatus")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("consumeMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeOrderlyContext")]),s._v(" consumeOrderlyContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"。消息："')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBody")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"。queueId:"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getQueueId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeOrderlyStatus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SUCCESS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10")]),s._v(" "),a("h4",{attrs:{id:"_1-3-事务消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-事务消息"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_1-3-%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("1.3 事务消息")]),s._v(" "),a("ol",[a("li",[s._v("正常事务过程")]),s._v(" "),a("li",[s._v("事务补偿过程")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211160454763.88ac51a3.png",alt:"image-20201211160454763"}})]),s._v(" "),a("h4",{attrs:{id:"_1-4-事务消息状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-事务消息状态"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_1-4-%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF%E7%8A%B6%E6%80%81",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("1.4 事务消息状态")]),s._v(" "),a("ol",[a("li",[s._v("提交状态：允许进入队列，此消息与非事务消息无区别")]),s._v(" "),a("li",[s._v("回滚状态：不允许进入队列，此消息等同于未发送过")]),s._v(" "),a("li",[s._v("中间状态：完成了half消息的发送，未对MQ进行二次状态确认")]),s._v(" "),a("li",[s._v("注意：事务消息仅与生产者有关，与消费者无关")])]),s._v(" "),a("h4",{attrs:{id:"_1-5-事务消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-事务消息"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_1-5-%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("1.5 事务消息")]),s._v(" "),a("p",[s._v("提交状态")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//事务消息使用的生产者是TransactionMQProducer")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionMQProducer")]),s._v(" producer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionMQProducer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nproducer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setNamesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9876"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//添加本地事务对应的监听")]),s._v("\nproducer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTransactionListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//正常事务过程")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("executeLocalTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMMIT_MESSAGE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//事务补偿过程")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkLocalTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),s._v(" messageExt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nproducer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"事务消息：hello rocketmq "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SendResult")]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessageInTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"返回结果："')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nproducer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19")]),s._v(" "),a("p",[s._v("回滚状态")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("            producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTransactionListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//正常事务")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("executeLocalTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROLLBACK_MESSAGE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//事务补偿")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkLocalTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),s._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12")]),s._v(" "),a("p",[s._v("中间状态")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionMQProducer")]),s._v(" producer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionMQProducer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setNamesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9876"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTransactionListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TransactionListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//正常事务")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("executeLocalTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UNKNOW")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//事务补偿 正常执行UNKNOW才会触发")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkLocalTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MessageExt")]),s._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"事务补偿"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalTransactionState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMMIT_MESSAGE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic13"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello rocketmq"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SendResult")]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessageInTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"返回结果："')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//事务补偿生产者一定要一直启动着")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//producer.shutdown();")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24")]),s._v(" "),a("h3",{attrs:{id:"_2-集群搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-集群搭建"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_2-%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("2. 集群搭建")]),s._v(" "),a("h4",{attrs:{id:"_2-1-rocketmq集群分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-rocketmq集群分类"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_2-1-rocketmq%E9%9B%86%E7%BE%A4%E5%88%86%E7%B1%BB",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("2.1 RocketMQ集群分类")]),s._v(" "),a("ol",[a("li",[s._v("单机\n"),a("ol",[a("li",[s._v("一个broker提供服务（宕机后服务瘫痪）")])])]),s._v(" "),a("li",[s._v("集群\n"),a("ol",[a("li",[s._v("多个broker提供服务（单机宕机后消息无法及时被消费）")]),s._v(" "),a("li",[s._v("多个master多个slave\n"),a("ol",[a("li",[s._v("master到slave消息同步方式为同步（较异步方式性能略低，消息无延迟）")]),s._v(" "),a("li",[s._v("master到slave消息同步方式为异步（较同步方式性能略高，数据略有延迟）")])])])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211160840336.f8e211bc.png",alt:"image-20201211160840336"}})]),s._v(" "),a("h4",{attrs:{id:"_2-2-rocketmq集群特征"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-rocketmq集群特征"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_2-2-rocketmq%E9%9B%86%E7%BE%A4%E7%89%B9%E5%BE%81",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("2.2 RocketMQ集群特征")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211160927121.1d9c9bbc.png",alt:"image-20201211160927121"}})]),s._v(" "),a("p",[s._v("RocketMQ集群工作流程")]),s._v(" "),a("ol",[a("li",[s._v("步骤1：NameServer启动，开启监听，等待broker、producer与consumer连接")]),s._v(" "),a("li",[s._v("步骤2：broker启动，根据配置信息，连接所有的NameServer，并保持长连接")]),s._v(" "),a("li",[s._v("步骤2补充：如果broker中有现存数据， NameServer将保存topic与broker关系")]),s._v(" "),a("li",[s._v("步骤3：producer发信息，连接某个NameServer，并建立长连接")]),s._v(" "),a("li",[s._v("步骤4：producer发消息\n"),a("ol",[a("li",[s._v("步骤4.1若果topic存在，由NameServer直接分配")]),s._v(" "),a("li",[s._v("步骤4.2如果topic不存在，由NameServer创建topic与broker关系，并分配")])])]),s._v(" "),a("li",[s._v("步骤5：producer在broker的topic选择一个消息队列（从列表中选择）")]),s._v(" "),a("li",[s._v("步骤6：producer与broker建立长连接，用于发送消息")]),s._v(" "),a("li",[s._v("步骤7：producer发送消息")])]),s._v(" "),a("p",[a("strong",[s._v("comsumer工作流程同producer")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210227230840419.9726b7cd.png",alt:"image-20210227230840419"}})]),s._v(" "),a("p",[s._v("双主双从集群搭建:")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20210228145023406.326553b2.png",alt:"image-20210228145023406"}})]),s._v(" "),a("p",[s._v("操作步骤："),a("strong",[s._v("注意两台机器同时操作")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("配置服务器环境:")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("vim")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/etc/hosts")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nameserver")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("192.168.200.129")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-nameserver1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("192.168.200.130")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-nameserver2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# broker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("192.168.200.129")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-master1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("192.168.200.129")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-slave2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("192.168.200.130")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-master2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("192.168.200.130")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-slave1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8")])]),s._v(" "),a("li",[a("p",[s._v("配置完毕后重启网卡，应用配置")])])]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("systemctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("restart network")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("关闭防火墙或者开发指定端口对外提供服务")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭防火墙")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("systemctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("stop firewalld.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看防火墙的状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("firewall-cmd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("--state")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止firewall开机启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("systemctl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("disable firewalld.service")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6")])]),s._v(" "),a("li",[a("p",[s._v("配置服务器环境")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("vim")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/etc/profile")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set rocketmq")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("ROCKETMQ_HOME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("PATH")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("$PATH:$ROCKETMQ_HOME/bin")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("ROCKETMQ_HOME PATH")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("1\n2\n3\n4")])]),s._v(" "),a("li",[a("p",[s._v("配置完毕后重启网卡，应用配置")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("source")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/etc/profile")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")])]),s._v(" "),a("li",[a("p",[s._v("将rocketmq解压到/rocketmq")])]),s._v(" "),a("li",[a("p",[s._v("创建集群服务器的数据存储目录")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#master 数据存储目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store/commitlog")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store/consumequeue")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store/index")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#slave 数据存储目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave/commitlog")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave/consumequeue")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave/index")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11")])]),s._v(" "),a("li",[a("p",[s._v("注意master与slave如果在同一个虚拟机中部署，需要将存储目录区分开")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("第一台129机器上")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /rocketmq/conf/2m-2s-sync\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vim broker-a.properties\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所属集群名字")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerClusterName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-cluster")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#broker名字，注意此处不同的配置文件填写的不一样")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("broker-a")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0 表示 Master，>0 表示 Slave")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nameServer地址，分号分割")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("namesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-nameserver1:9876;rocketmq-nameserver2:9876")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("defaultTopicQueueNums")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("autoCreateTopicEnable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("autoCreateSubscriptionGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Broker 对外服务的监听端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("listenPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("10911")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除文件时间点，默认凌晨 4点")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("deleteWhen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("04")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件保留时间，默认 48 小时")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("fileReservedTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("120")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#commitLog每个文件的大小默认1G")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mapedFileSizeCommitLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1073741824")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ConsumeQueue每个文件默认存30W条，根据业务情况调整")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mapedFileSizeConsumeQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("300000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#destroyMapedFileIntervalForcibly=120000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#redeleteHangedFileInterval=120000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检测物理文件磁盘空间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("diskMaxUsedSpaceRatio")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("88")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathRootDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#commitLog 存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathCommitLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store/commitlog")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#消费队列存储路径存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathConsumeQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store/consumequeue")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#消息索引存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathIndex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store/index")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#checkpoint 文件存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storeCheckpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store/checkpoint")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#abort 文件存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("abortFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store/abort")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限制的消息大小")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("maxMessageSize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("65536")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushCommitLogLeastPages=4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushConsumeQueueLeastPages=2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushCommitLogThoroughInterval=10000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushConsumeQueueThoroughInterval=60000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Broker 的角色")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- ASYNC_MASTER 异步复制Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SYNC_MASTER 同步双写Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SLAVE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerRole")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("SYNC_MASTER")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#刷盘方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- ASYNC_FLUSH 异步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SYNC_FLUSH 同步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("flushDiskType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("SYNC_FLUSH")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#checkTransactionMessageEnable=false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发消息线程池数量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sendMessageThreadPoolNums=128")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拉消息线程池数量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pullMessageThreadPoolNums=128")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vim broker-b-s.properties\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所属集群名字")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerClusterName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-cluster")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#broker名字，注意此处不同的配置文件填写的不一样")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("broker-b")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0 表示 Master，>0 表示 Slave")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nameServer地址，分号分割")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("namesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-nameserver1:9876;rocketmq-nameserver2:9876")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("defaultTopicQueueNums")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("autoCreateTopicEnable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("autoCreateSubscriptionGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Broker 对外服务的监听端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("listenPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("11011")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除文件时间点，默认凌晨 4点")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("deleteWhen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("04")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件保留时间，默认 48 小时")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("fileReservedTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("120")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#commitLog每个文件的大小默认1G")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mapedFileSizeCommitLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1073741824")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ConsumeQueue每个文件默认存30W条，根据业务情况调整")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mapedFileSizeConsumeQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("300000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#destroyMapedFileIntervalForcibly=120000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#redeleteHangedFileInterval=120000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检测物理文件磁盘空间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("diskMaxUsedSpaceRatio")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("88")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathRootDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#commitLog 存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathCommitLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave/commitlog")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#消费队列存储路径存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathConsumeQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave/consumequeue")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#消息索引存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathIndex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave/index")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#checkpoint 文件存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storeCheckpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave/checkpoint")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#abort 文件存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("abortFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave/abort")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限制的消息大小")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("maxMessageSize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("65536")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushCommitLogLeastPages=4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushConsumeQueueLeastPages=2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushCommitLogThoroughInterval=10000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushConsumeQueueThoroughInterval=60000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Broker 的角色")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- ASYNC_MASTER 异步复制Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SYNC_MASTER 同步双写Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SLAVE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerRole")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("SLAVE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#刷盘方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- ASYNC_FLUSH 异步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SYNC_FLUSH 同步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("flushDiskType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("ASYNC_FLUSH")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#checkTransactionMessageEnable=false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发消息线程池数量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sendMessageThreadPoolNums=128")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拉消息线程池数量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pullMessageThreadPoolNums=128")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rm -rf broker-a-s.properties\nrm -rf broker-b.properties\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("1\n2")]),s._v(" "),a("p",[a("strong",[s._v("第二台130机器上")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /rocketmq/conf/2m-2s-sync\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vim broker-b.properties\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所属集群名字")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerClusterName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-cluster")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#broker名字，注意此处不同的配置文件填写的不一样")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("broker-b")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0 表示 Master，>0 表示 Slave")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nameServer地址，分号分割")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("namesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-nameserver1:9876;rocketmq-nameserver2:9876")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("defaultTopicQueueNums")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("autoCreateTopicEnable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("autoCreateSubscriptionGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Broker 对外服务的监听端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("listenPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("10911")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除文件时间点，默认凌晨 4点")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("deleteWhen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("04")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件保留时间，默认 48 小时")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("fileReservedTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("120")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#commitLog每个文件的大小默认1G")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mapedFileSizeCommitLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1073741824")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ConsumeQueue每个文件默认存30W条，根据业务情况调整")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mapedFileSizeConsumeQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("300000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#destroyMapedFileIntervalForcibly=120000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#redeleteHangedFileInterval=120000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检测物理文件磁盘空间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("diskMaxUsedSpaceRatio")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("88")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathRootDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#commitLog 存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathCommitLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store/commitlog")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#消费队列存储路径存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathConsumeQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store/consumequeue")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#消息索引存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathIndex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store/index")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#checkpoint 文件存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storeCheckpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store/checkpoint")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#abort 文件存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("abortFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store/abort")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限制的消息大小")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("maxMessageSize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("65536")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushCommitLogLeastPages=4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushConsumeQueueLeastPages=2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushCommitLogThoroughInterval=10000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushConsumeQueueThoroughInterval=60000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Broker 的角色")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- ASYNC_MASTER 异步复制Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SYNC_MASTER 同步双写Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SLAVE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerRole")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("SYNC_MASTER")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#刷盘方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- ASYNC_FLUSH 异步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SYNC_FLUSH 同步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("flushDiskType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("SYNC_FLUSH")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#checkTransactionMessageEnable=false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发消息线程池数量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sendMessageThreadPoolNums=128")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拉消息线程池数量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pullMessageThreadPoolNums=128")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vim broker-a-s.properties\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所属集群名字")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerClusterName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-cluster")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#broker名字，注意此处不同的配置文件填写的不一样")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("broker-a")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0 表示 Master，>0 表示 Slave")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nameServer地址，分号分割")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("namesrvAddr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("rocketmq-nameserver1:9876;rocketmq-nameserver2:9876")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("defaultTopicQueueNums")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("autoCreateTopicEnable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("autoCreateSubscriptionGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Broker 对外服务的监听端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("listenPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("11011")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除文件时间点，默认凌晨 4点")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("deleteWhen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("04")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件保留时间，默认 48 小时")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("fileReservedTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("120")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#commitLog每个文件的大小默认1G")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mapedFileSizeCommitLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1073741824")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ConsumeQueue每个文件默认存30W条，根据业务情况调整")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("mapedFileSizeConsumeQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("300000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#destroyMapedFileIntervalForcibly=120000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#redeleteHangedFileInterval=120000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检测物理文件磁盘空间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("diskMaxUsedSpaceRatio")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("88")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathRootDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#commitLog 存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathCommitLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave/commitlog")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#消费队列存储路径存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathConsumeQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave/consumequeue")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#消息索引存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storePathIndex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave/index")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#checkpoint 文件存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("storeCheckpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave/checkpoint")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#abort 文件存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("abortFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/store-slave/abort")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#限制的消息大小")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("maxMessageSize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("65536")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushCommitLogLeastPages=4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushConsumeQueueLeastPages=2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushCommitLogThoroughInterval=10000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flushConsumeQueueThoroughInterval=60000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Broker 的角色")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- ASYNC_MASTER 异步复制Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SYNC_MASTER 同步双写Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SLAVE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerRole")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("SLAVE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#刷盘方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- ASYNC_FLUSH 异步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SYNC_FLUSH 同步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("flushDiskType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("ASYNC_FLUSH")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#checkTransactionMessageEnable=false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发消息线程池数量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sendMessageThreadPoolNums=128")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拉消息线程池数量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pullMessageThreadPoolNums=128")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rm -rf broker-a.properties\nrm -rf broker-b-s.properties\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("1\n2")])]),s._v(" "),a("li",[a("p",[s._v("检查启动内存")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("vim")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/rocketmq/bin/runbroker.sh")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开发环境配置 JVM Configuration")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("JAVA_OPT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"${JAVA_OPT} -server -Xms256m -Xmx256m -Xmn128m"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("1\n2")])]),s._v(" "),a("li",[a("p",[s._v("启动服务器（在bin目录下依次启动）")]),s._v(" "),a("p",[s._v("129上")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("nohup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("sh mqnamesrv &")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("nohup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("sh mqbroker -c ../conf/2m-2s-sync/broker-a.properties &")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("nohup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("sh mqbroker -c ../conf/2m-2s-sync/broker-b-s.properties &")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")])])]),s._v(" "),a("p",[s._v("130上")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("nohup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("sh mqnamesrv &")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("nohup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("sh mqbroker -c ../conf/2m-2s-sync/broker-a-s.properties &")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("nohup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("sh mqbroker -c ../conf/2m-2s-sync/broker-b.properties & ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("1")]),s._v(" "),a("h4",{attrs:{id:"_4-3-rocketmq-console集群监控平台搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-rocketmq-console集群监控平台搭建"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_4-3-rocketmq-console%E9%9B%86%E7%BE%A4%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("4.3 rocketmq-console集群监控平台搭建")]),s._v(" "),a("ol",[a("li",[s._v("incubator-rocketmq-externals是一个基于rocketmq的基础之上扩展开发的开源项目")]),s._v(" "),a("li",[s._v("获取地址：https://github.com/apache/rocketmq-externals")]),s._v(" "),a("li",[s._v("rocketmq-console是一款基于java环境开发的（springboot）的管理控制台工具")])]),s._v(" "),a("h3",{attrs:{id:"_3-高级特性-重点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-高级特性-重点"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7-%E9%87%8D%E7%82%B9",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3. 高级特性（重点）")]),s._v(" "),a("h4",{attrs:{id:"_3-1-消息的存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-消息的存储"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-1-%E6%B6%88%E6%81%AF%E7%9A%84%E5%AD%98%E5%82%A8",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3.1 消息的存储")]),s._v(" "),a("ol",[a("li",[s._v("消息生成者发送消息到MQ")]),s._v(" "),a("li",[s._v("MQ返回ACK给生产者")]),s._v(" "),a("li",[s._v("MQ push 消息给对应的消费者")]),s._v(" "),a("li",[s._v("消息消费者返回ACK给MQ")])]),s._v(" "),a("p",[s._v("说明：ACK（Acknowledge character）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211162105593.da7ab600.png",alt:"image-20201211162105593"}})]),s._v(" "),a("h4",{attrs:{id:"_3-2-消息的存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-消息的存储"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-2-%E6%B6%88%E6%81%AF%E7%9A%84%E5%AD%98%E5%82%A8",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3.2 消息的存储")]),s._v(" "),a("ol",[a("li",[s._v("消息生成者发送消息到MQ")]),s._v(" "),a("li",[s._v("MQ收到消息，将消息进行持久化，存储该消息")]),s._v(" "),a("li",[s._v("MQ返回ACK给生产者")]),s._v(" "),a("li",[s._v("MQ push 消息给对应的消费者")]),s._v(" "),a("li",[s._v("消息消费者返回ACK给MQ")]),s._v(" "),a("li",[s._v("MQ删除消息")])]),s._v(" "),a("p",[s._v("注意：")]),s._v(" "),a("ol",[a("li",[s._v("第⑤步MQ在指定时间内接到消息消费者返回ACK，MQ认定消息消费成功，执行⑥")]),s._v(" "),a("li",[s._v("第⑤步MQ在指定时间内未接到消息消费者返回ACK，MQ认定消息消费失败，重新执行④⑤⑥")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211162231313.9285f9b2.png",alt:"image-20201211162231313"}})]),s._v(" "),a("h4",{attrs:{id:"_3-3-消息的存储介质"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-消息的存储介质"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-3-%E6%B6%88%E6%81%AF%E7%9A%84%E5%AD%98%E5%82%A8%E4%BB%8B%E8%B4%A8",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3.3 消息的存储介质")]),s._v(" "),a("ol",[a("li",[s._v("数据库\n"),a("ol",[a("li",[s._v("ActiveMQ")]),s._v(" "),a("li",[s._v("缺点：数据库瓶颈将成为MQ瓶颈")])])]),s._v(" "),a("li",[s._v("文件系统\n"),a("ol",[a("li",[s._v("RocketMQ/Kafka/RabbitMQ")]),s._v(" "),a("li",[s._v("解决方案：采用消息刷盘机制进行数据存储")]),s._v(" "),a("li",[s._v("缺点：硬盘损坏的问题无法避免")])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211162334322.221493d8.png",alt:"image-20201211162334322"}})]),s._v(" "),a("h4",{attrs:{id:"_3-4-高效的消息存储与读写方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-高效的消息存储与读写方式"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-4-%E9%AB%98%E6%95%88%E7%9A%84%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8%E4%B8%8E%E8%AF%BB%E5%86%99%E6%96%B9%E5%BC%8F",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3.4 高效的消息存储与读写方式")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("SSD（Solid State Disk）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211162416020.37016a21.png",alt:"image-20201211162416020"}})]),s._v(" "),a("ol",[a("li",[a("p",[s._v("随机写（100KB/s）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211162448564.28e735f2.png",alt:"image-20201211162448564"}})])]),s._v(" "),a("li",[a("p",[s._v("顺序写 （600MB/s）1秒1部电影")])])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211162541076.35fabc45.png",alt:"image-20201211162541076"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211162638525.b15728cc.png",alt:"image-20201211162638525"}})]),s._v(" "),a("ol",[a("li",[a("p",[s._v("Linux系统发送数据的方式")])]),s._v(" "),a("li",[a("p",[s._v("“零拷贝”技术")]),s._v(" "),a("ol",[a("li",[s._v("数据传输由传统的4次复制简化成3次复制，减少1次复制过程")]),s._v(" "),a("li",[s._v("Java语言中使用MappedByteBuffer类实现了该技术")]),s._v(" "),a("li",[s._v("要求：预留存储空间，用于保存数据（1G存储空间起步）")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211162729614.fd985403.png",alt:"image-20201211162729614"}})])])]),s._v(" "),a("h4",{attrs:{id:"_3-5-消息存储结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-消息存储结构"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-5-%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3.5 消息存储结构")]),s._v(" "),a("ol",[a("li",[s._v("MQ数据存储区域包含如下内容\n"),a("ol",[a("li",[s._v("消息数据存储区域\n"),a("ol",[a("li",[s._v("topic")]),s._v(" "),a("li",[s._v("queueId")]),s._v(" "),a("li",[s._v("message")])])]),s._v(" "),a("li",[s._v("消费逻辑队列\n"),a("ol",[a("li",[s._v("minOffset")]),s._v(" "),a("li",[s._v("maxOffset")]),s._v(" "),a("li",[s._v("consumerOffset")])])]),s._v(" "),a("li",[s._v("索引\n"),a("ol",[a("li",[s._v("key索引")]),s._v(" "),a("li",[s._v("创建时间索引")])])])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211162857722.2ff7e84e.png",alt:"image-20201211162857722"}})]),s._v(" "),a("h4",{attrs:{id:"_3-6-刷盘机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-刷盘机制"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_3-6-%E5%88%B7%E7%9B%98%E6%9C%BA%E5%88%B6",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("3.6 刷盘机制")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("同步刷盘")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("生产者发送消息到MQ，MQ接到消息数据")])]),s._v(" "),a("li",[a("p",[s._v("MQ挂起生产者发送消息的线程")])]),s._v(" "),a("li",[a("p",[s._v("MQ将消息数据写入内存")])]),s._v(" "),a("li",[a("p",[s._v("内存数据写入硬盘")])]),s._v(" "),a("li",[a("p",[s._v("磁盘存储后返回SUCCESS")])]),s._v(" "),a("li",[a("p",[s._v("MQ恢复挂起的生产者线程")])]),s._v(" "),a("li",[a("p",[s._v("发送ACK到生产者")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211163159680.93998f9b.png",alt:"image-20201211163159680"}})])])])]),s._v(" "),a("li",[a("p",[s._v("异步刷盘")]),s._v(" "),a("ol",[a("li",[s._v("生产者发送消息到MQ，MQ接到消息数据")]),s._v(" "),a("li"),s._v(" "),a("li",[s._v("MQ将消息数据写入内存")]),s._v(" "),a("li"),s._v(" "),a("li"),s._v(" "),a("li"),s._v(" "),a("li",[s._v("发送ACK到生产者")])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211163238738.eb3bcd53.png",alt:"image-20201211163238738"}})]),s._v(" "),a("ol",[a("li",[s._v("同步刷盘：安全性高，效率低，速度慢（适用于对数据安全要求较高的业务）")]),s._v(" "),a("li",[s._v("异步刷盘：安全性低，效率高，速度快（适用于对数据处理速度要求较高的业务）")])]),s._v(" "),a("p",[a("strong",[s._v("配置方式")])]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#刷盘方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- ASYNC_FLUSH 异步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SYNC_FLUSH 同步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("flushDiskType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("SYNC_FLUSH")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("1\n2\n3\n4")]),s._v(" "),a("h4",{attrs:{id:"_5-7-高可用性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-7-高可用性"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-7-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.7 高可用性")]),s._v(" "),a("ol",[a("li",[s._v("nameserver\n"),a("ol",[a("li",[s._v("无状态+全服务器注册")])])]),s._v(" "),a("li",[s._v("消息服务器\n"),a("ol",[a("li",[s._v("主从架构（2M-2S）")])])]),s._v(" "),a("li",[s._v("消息生产\n"),a("ol",[a("li",[s._v("生产者将相同的topic绑定到多个group组，保障master挂掉后，其他master仍可正常进行消 息接收")])])]),s._v(" "),a("li",[s._v("消息消费\n"),a("ol",[a("li",[s._v("RocketMQ自身会根据master的压力确认是否由master承担消息读取的功能，当master繁忙 时候，自动切换由slave承担数据读取的工作")])])])]),s._v(" "),a("h4",{attrs:{id:"_5-8-主从数据复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-8-主从数据复制"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-8-%E4%B8%BB%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%A4%8D%E5%88%B6",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.8 主从数据复制")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("同步复制")]),s._v(" "),a("ol",[a("li",[s._v("master接到消息后，先复制到slave，然后反馈给生产者写操作成功")]),s._v(" "),a("li",[s._v("优点：数据安全，不丢数据，出现故障容易恢复")]),s._v(" "),a("li",[s._v("缺点：影响数据吞吐量，整体性能低")])])]),s._v(" "),a("li",[a("p",[s._v("异步复制")]),s._v(" "),a("ol",[a("li",[s._v("master接到消息后，立即返回给生产者写操作成功，当消息达到一定量后再异步复制到slave")]),s._v(" "),a("li",[s._v("优点：数据吞吐量大，操作延迟低，性能高")]),s._v(" "),a("li",[s._v("缺点：数据不安全，会出现数据丢失的现象，一旦master出现故障，从上次数据同步到故障时间的数据将丢失")])])]),s._v(" "),a("li",[a("p",[s._v("配置方式")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Broker 的角色")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- ASYNC_MASTER 异步复制Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SYNC_MASTER 同步双写Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#- SLAVE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("brokerRole")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("SYNC_MASTER")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("1\n2\n3\n4\n5")])])]),s._v(" "),a("h4",{attrs:{id:"_5-9-负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-9-负载均衡"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-9-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.9 负载均衡")]),s._v(" "),a("ol",[a("li",[s._v("Producer负载均衡\n"),a("ol",[a("li",[s._v("内部实现了不同broker集群中对同一topic对应消息队列的负载均衡")])])]),s._v(" "),a("li",[s._v("Consumer负载均衡\n"),a("ol",[a("li",[s._v("平均分配")]),s._v(" "),a("li",[s._v("循环平均分配")])])]),s._v(" "),a("li",[s._v("广播模式（不参与负载均衡）")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211163654002.33a93491.png",alt:"image-20201211163654002"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211163706995.3eb09b97.png",alt:"image-20201211163706995"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211163736770.58dc53f1.png",alt:"image-20201211163736770"}})]),s._v(" "),a("h4",{attrs:{id:"_5-10-消息重试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-10-消息重试"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-10-%E6%B6%88%E6%81%AF%E9%87%8D%E8%AF%95",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.10 消息重试")]),s._v(" "),a("ol",[a("li",[s._v("当消息消费后未正常返回消费成功的信息将启动消息重试机制")]),s._v(" "),a("li",[s._v("消息重试机制\n"),a("ol",[a("li",[s._v("顺序消息")]),s._v(" "),a("li",[s._v("无序消息")])])])]),s._v(" "),a("h5",{attrs:{id:"_5-10-1-顺序消息重试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-10-1-顺序消息重试"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-10-1-%E9%A1%BA%E5%BA%8F%E6%B6%88%E6%81%AF%E9%87%8D%E8%AF%95",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.10.1 顺序消息重试")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211163848104.704cd4c8.png",alt:"image-20201211163848104"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211163854405.4a9e5f3f.png",alt:"image-20201211163854405"}})]),s._v(" "),a("ol",[a("li",[s._v("当消费者消费消息失败后，RocketMQ会自动进行消息重试（每次间隔时间为 1 秒）")]),s._v(" "),a("li",[s._v("注意：应用会出现消息消费被阻塞的情况，因此，要对顺序消息的消费情况进行监控，避免阻塞现象的发生")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211163910587.d0277d4a.png",alt:"image-20201211163910587"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211163928369.22d707c7.png",alt:"image-20201211163928369"}})]),s._v(" "),a("h5",{attrs:{id:"_5-10-2-无序消息重试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-10-2-无序消息重试"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-10-2-%E6%97%A0%E5%BA%8F%E6%B6%88%E6%81%AF%E9%87%8D%E8%AF%95",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.10.2 无序消息重试")]),s._v(" "),a("ol",[a("li",[s._v("无序消息包括普通消息、定时消息、延时消息、事务消息")]),s._v(" "),a("li",[s._v("无序消息重试仅适用于负载均衡（集群）模型下的消息消费，不适用于广播模式下的消息消费")]),s._v(" "),a("li",[s._v("为保障无序消息的消费，MQ设定了合理的消息重试间隔时长")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211164005887.fdcb00ba.png",alt:"image-20201211164005887"}})]),s._v(" "),a("h4",{attrs:{id:"_5-11-死信队列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-11-死信队列"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-11-%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.11 死信队列")]),s._v(" "),a("ol",[a("li",[s._v("当消息消费重试到达了指定次数（默认16次）后，MQ将无法被正常消费的消息称为死信消息（Dead-Letter Message）")]),s._v(" "),a("li",[s._v("死信消息不会被直接抛弃，而是保存到了一个全新的队列中，该队列称为死信队列（Dead-Letter Queue）\\")]),s._v(" "),a("li",[s._v("死信队列特征\n"),a("ol",[a("li",[s._v("归属某一个组（Gourp Id），而不归属Topic，也不归属消费者")]),s._v(" "),a("li",[s._v("一个死信队列中可以包含同一个组下的多个Topic中的死信消息")]),s._v(" "),a("li",[s._v("死信队列不会进行默认初始化，当第一个死信出现后，此队列首次初始化")])])]),s._v(" "),a("li",[s._v("死信队列中消息特征\n"),a("ol",[a("li",[s._v("不会被再次重复消费")]),s._v(" "),a("li",[s._v("死信队列中的消息有效期为3天，达到时限后将被清除")])])])]),s._v(" "),a("h4",{attrs:{id:"_5-12-死信处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-12-死信处理"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-12-%E6%AD%BB%E4%BF%A1%E5%A4%84%E7%90%86",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.12 死信处理")]),s._v(" "),a("ol",[a("li",[s._v("在监控平台中，通过查找死信，获取死信的messageId，然后通过id对死信进行精准消费")])]),s._v(" "),a("h4",{attrs:{id:"_5-13-消息重复消费"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-13-消息重复消费"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-13-%E6%B6%88%E6%81%AF%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.13 消息重复消费")]),s._v(" "),a("ol",[a("li",[s._v("消息重复消费原因\n"),a("ol",[a("li",[s._v("生产者发送了重复的消息\n"),a("ol",[a("li",[s._v("网络闪断")]),s._v(" "),a("li",[s._v("生产者宕机")])])]),s._v(" "),a("li",[s._v("消息服务器投递了重复的消息\n"),a("ol",[a("li",[s._v("网络闪断")])])]),s._v(" "),a("li",[s._v("动态的负载均衡过程\n"),a("ol",[a("li",[s._v("网络闪断/抖动")]),s._v(" "),a("li",[s._v("broker重启")]),s._v(" "),a("li",[s._v("订阅方应用重启（消费者）")]),s._v(" "),a("li",[s._v("客户端扩容")]),s._v(" "),a("li",[s._v("客户端缩容")])])])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20201211164244534.0bb9f42c.png",alt:"image-20201211164244534"}})]),s._v(" "),a("h4",{attrs:{id:"_5-14-消息幂等"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-14-消息幂等"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/distribute/rocketmq/#_5-14-%E6%B6%88%E6%81%AF%E5%B9%82%E7%AD%89",target:"_blank",rel:"noopener noreferrer"}},[s._v("#"),a("OutboundLink")],1),s._v("5.14 消息幂等")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("对同一条消息，无论消费多少次，结果保持一致，称为消息幂等性")])]),s._v(" "),a("li",[a("p",[s._v("解决方案")]),s._v(" "),a("ol",[a("li",[s._v("使用业务id作为消息的key")]),s._v(" "),a("li",[s._v("在消费消息时，客户端对key做判定，未使用过放行，使用过抛弃")])])]),s._v(" "),a("li",[a("p",[s._v("注意：messageId由RocketMQ产生，messageId并不具有唯一性，不能作用幂等判定条件")])]),s._v(" "),a("li",[a("p",[s._v("常见的幂等方法示例")]),s._v(" "),a("p",[s._v("•新增:不幂等 insert into order values (……)")]),s._v(" "),a("p",[s._v("•查询:幂等")]),s._v(" "),a("p",[s._v("•删除:幂等 delete from 表 where id =1")]),s._v(" "),a("p",[s._v("•修改:不幂等 update account set balance = balance+100 where no=1")]),s._v(" "),a("p",[s._v("•修改:幂等 update account set balance =100 where no=1")])])]),s._v(" "),a("p",[s._v("计算机考研：")]),s._v(" "),a("p",[s._v("1计算机组成原理 ：")]),s._v(" "),a("p",[s._v("2网络：3次握手 4次挥手")]),s._v(" "),a("p",[s._v("3操作系统：linux")]),s._v(" "),a("p",[s._v("4数据结构-算法：tree b+ 链表")]),s._v(" "),a("p",[s._v("执行力")])])}),[],!1,null,null,null);t.default=e.exports}}]);