<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SPRING-DATA-JPA | 路飞的文档资料</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/王路飞.jpg">
    <link rel="stylesheet" href="/css/style.css">
    <meta name="description" content="My tech blog">
    
    <link rel="preload" href="/assets/css/0.styles.f108afa7.css" as="style"><link rel="preload" href="/assets/js/app.a99a21a8.js" as="script"><link rel="preload" href="/assets/js/2.8a7c9856.js" as="script"><link rel="preload" href="/assets/js/66.1e4105ac.js" as="script"><link rel="prefetch" href="/assets/js/10.d30ea028.js"><link rel="prefetch" href="/assets/js/100.5c756eef.js"><link rel="prefetch" href="/assets/js/101.3c8c302a.js"><link rel="prefetch" href="/assets/js/102.e180901e.js"><link rel="prefetch" href="/assets/js/103.536397dd.js"><link rel="prefetch" href="/assets/js/104.d3be4c89.js"><link rel="prefetch" href="/assets/js/105.265e7930.js"><link rel="prefetch" href="/assets/js/106.976557ee.js"><link rel="prefetch" href="/assets/js/107.f5f00580.js"><link rel="prefetch" href="/assets/js/108.351b860b.js"><link rel="prefetch" href="/assets/js/109.db80b1a0.js"><link rel="prefetch" href="/assets/js/11.da5e694f.js"><link rel="prefetch" href="/assets/js/110.667d346a.js"><link rel="prefetch" href="/assets/js/111.fc07df98.js"><link rel="prefetch" href="/assets/js/112.5f4a6e10.js"><link rel="prefetch" href="/assets/js/113.d20a7c0c.js"><link rel="prefetch" href="/assets/js/114.616183c5.js"><link rel="prefetch" href="/assets/js/115.199efe05.js"><link rel="prefetch" href="/assets/js/116.f44506de.js"><link rel="prefetch" href="/assets/js/12.51b1d48f.js"><link rel="prefetch" href="/assets/js/13.ef3b38d6.js"><link rel="prefetch" href="/assets/js/14.7b3969ad.js"><link rel="prefetch" href="/assets/js/15.f6b509fd.js"><link rel="prefetch" href="/assets/js/16.3417b54e.js"><link rel="prefetch" href="/assets/js/17.0ff216f5.js"><link rel="prefetch" href="/assets/js/18.c5742e2c.js"><link rel="prefetch" href="/assets/js/19.a44e3170.js"><link rel="prefetch" href="/assets/js/20.9fff1bea.js"><link rel="prefetch" href="/assets/js/21.ccbba9c3.js"><link rel="prefetch" href="/assets/js/22.deb83c90.js"><link rel="prefetch" href="/assets/js/23.1adad323.js"><link rel="prefetch" href="/assets/js/24.b097f42b.js"><link rel="prefetch" href="/assets/js/25.7bc9d615.js"><link rel="prefetch" href="/assets/js/26.1393dbc0.js"><link rel="prefetch" href="/assets/js/27.cdbe1068.js"><link rel="prefetch" href="/assets/js/28.73126441.js"><link rel="prefetch" href="/assets/js/29.d64939f1.js"><link rel="prefetch" href="/assets/js/3.a9893adf.js"><link rel="prefetch" href="/assets/js/30.5ae934e2.js"><link rel="prefetch" href="/assets/js/31.dd655094.js"><link rel="prefetch" href="/assets/js/32.a00e3a52.js"><link rel="prefetch" href="/assets/js/33.aa7c367f.js"><link rel="prefetch" href="/assets/js/34.fb89b50e.js"><link rel="prefetch" href="/assets/js/35.7396f270.js"><link rel="prefetch" href="/assets/js/36.df78ac5b.js"><link rel="prefetch" href="/assets/js/37.38c7da35.js"><link rel="prefetch" href="/assets/js/38.1cf2f5fe.js"><link rel="prefetch" href="/assets/js/39.a177497a.js"><link rel="prefetch" href="/assets/js/4.60326174.js"><link rel="prefetch" href="/assets/js/40.bc5c4fe3.js"><link rel="prefetch" href="/assets/js/41.579c8e71.js"><link rel="prefetch" href="/assets/js/42.b3369b5c.js"><link rel="prefetch" href="/assets/js/43.e8c5f3e5.js"><link rel="prefetch" href="/assets/js/44.113bb0e5.js"><link rel="prefetch" href="/assets/js/45.42aaa5b0.js"><link rel="prefetch" href="/assets/js/46.9abf2136.js"><link rel="prefetch" href="/assets/js/47.66d72f55.js"><link rel="prefetch" href="/assets/js/48.8625ccf2.js"><link rel="prefetch" href="/assets/js/49.a4ea028c.js"><link rel="prefetch" href="/assets/js/5.c30196e4.js"><link rel="prefetch" href="/assets/js/50.389b7244.js"><link rel="prefetch" href="/assets/js/51.c1d35a19.js"><link rel="prefetch" href="/assets/js/52.e1b83549.js"><link rel="prefetch" href="/assets/js/53.38f7fab5.js"><link rel="prefetch" href="/assets/js/54.4f40dd81.js"><link rel="prefetch" href="/assets/js/55.5689b890.js"><link rel="prefetch" href="/assets/js/56.21137f36.js"><link rel="prefetch" href="/assets/js/57.518f3336.js"><link rel="prefetch" href="/assets/js/58.356e923b.js"><link rel="prefetch" href="/assets/js/59.fe340bc6.js"><link rel="prefetch" href="/assets/js/6.4449c606.js"><link rel="prefetch" href="/assets/js/60.218edac5.js"><link rel="prefetch" href="/assets/js/61.fca5a945.js"><link rel="prefetch" href="/assets/js/62.46e53909.js"><link rel="prefetch" href="/assets/js/63.b043fdcd.js"><link rel="prefetch" href="/assets/js/64.438e56c9.js"><link rel="prefetch" href="/assets/js/65.9cadb16a.js"><link rel="prefetch" href="/assets/js/67.f1b195e8.js"><link rel="prefetch" href="/assets/js/68.3ae6d8a4.js"><link rel="prefetch" href="/assets/js/69.cb229910.js"><link rel="prefetch" href="/assets/js/7.e196e71b.js"><link rel="prefetch" href="/assets/js/70.087ed4a9.js"><link rel="prefetch" href="/assets/js/71.1c972e2a.js"><link rel="prefetch" href="/assets/js/72.c4400563.js"><link rel="prefetch" href="/assets/js/73.c9e68b10.js"><link rel="prefetch" href="/assets/js/74.6a6dc52f.js"><link rel="prefetch" href="/assets/js/75.acaf4eb9.js"><link rel="prefetch" href="/assets/js/76.5d2bbd8a.js"><link rel="prefetch" href="/assets/js/77.7f26bb80.js"><link rel="prefetch" href="/assets/js/78.aa8f1d38.js"><link rel="prefetch" href="/assets/js/79.010211c0.js"><link rel="prefetch" href="/assets/js/8.e64e8e39.js"><link rel="prefetch" href="/assets/js/80.dbddada4.js"><link rel="prefetch" href="/assets/js/81.a0ffa5f9.js"><link rel="prefetch" href="/assets/js/82.ea5a5a27.js"><link rel="prefetch" href="/assets/js/83.d4ed62f5.js"><link rel="prefetch" href="/assets/js/84.07d769ef.js"><link rel="prefetch" href="/assets/js/85.aa4cba04.js"><link rel="prefetch" href="/assets/js/86.2cd7334f.js"><link rel="prefetch" href="/assets/js/87.6c46d35c.js"><link rel="prefetch" href="/assets/js/88.4f60ec0d.js"><link rel="prefetch" href="/assets/js/89.f9228077.js"><link rel="prefetch" href="/assets/js/9.3f2a4df1.js"><link rel="prefetch" href="/assets/js/90.a216ad60.js"><link rel="prefetch" href="/assets/js/91.c67aa91a.js"><link rel="prefetch" href="/assets/js/92.3979d42f.js"><link rel="prefetch" href="/assets/js/93.f27cad9d.js"><link rel="prefetch" href="/assets/js/94.0e6e84dc.js"><link rel="prefetch" href="/assets/js/95.b38f952e.js"><link rel="prefetch" href="/assets/js/96.79ec6fa8.js"><link rel="prefetch" href="/assets/js/97.16d35a6e.js"><link rel="prefetch" href="/assets/js/98.768da8d6.js"><link rel="prefetch" href="/assets/js/99.0d3f010c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f108afa7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">路飞的文档资料</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/ahead/" class="nav-link">
  学习路线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><span class="title">Java基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java基础" class="mobile-dropdown-title"><span class="title">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/chick/" class="nav-link">
  1、纯基础
</a></li><li class="dropdown-item"><!----> <a href="/base/fengzhuang/" class="nav-link">
  2、面向对象之封装
</a></li><li class="dropdown-item"><!----> <a href="/base/extends/" class="nav-link">
  3、面向对象之继承
</a></li><li class="dropdown-item"><!----> <a href="/base/duotai/" class="nav-link">
  4、面向对象之多态
</a></li><li class="dropdown-item"><!----> <a href="/base/other/" class="nav-link">
  5、面向对象其他知识
</a></li><li class="dropdown-item"><!----> <a href="/base/jvm/" class="nav-link">
  6、jvm
</a></li><li class="dropdown-item"><!----> <a href="/base/api/" class="nav-link">
  7、常用api
</a></li><li class="dropdown-item"><!----> <a href="/base/exception/" class="nav-link">
  8、异常处理
</a></li><li class="dropdown-item"><!----> <a href="/base/fanxing/" class="nav-link">
  9、泛型
</a></li><li class="dropdown-item"><!----> <a href="/base/enum/" class="nav-link">
  9、枚举
</a></li><li class="dropdown-item"><!----> <a href="/base/thread/" class="nav-link">
  10、多线程
</a></li><li class="dropdown-item"><!----> <a href="/base/tree/" class="nav-link">
  11、树
</a></li><li class="dropdown-item"><!----> <a href="/base/collection/" class="nav-link">
  12、集合
</a></li><li class="dropdown-item"><!----> <a href="/base/io/" class="nav-link">
  13、IO流
</a></li><li class="dropdown-item"><!----> <a href="/base/reflect/" class="nav-link">
  14、反射
</a></li><li class="dropdown-item"><!----> <a href="/base/socket/" class="nav-link">
  15、网络编程
</a></li><li class="dropdown-item"><!----> <a href="/base/nio/" class="nav-link">
  16、NIO
</a></li><li class="dropdown-item"><!----> <a href="/base/express/" class="nav-link">
  17、正则表达式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="必会工具系统" class="dropdown-title"><span class="title">必会工具系统</span> <span class="arrow down"></span></button> <button type="button" aria-label="必会工具系统" class="mobile-dropdown-title"><span class="title">必会工具系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/linux/" class="nav-link">
  1、Linux
</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">
  2、Git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/chick/" class="nav-link">
  1、MySql入门
</a></li><li class="dropdown-item"><!----> <a href="/database/god/" class="nav-link">
  2、MySql进阶
</a></li><li class="dropdown-item"><!----> <a href="/database/jdbc/" class="nav-link">
  3、JDBC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaWeb" class="dropdown-title"><span class="title">JavaWeb</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaWeb" class="mobile-dropdown-title"><span class="title">JavaWeb</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javaweb/html/" class="nav-link">
  1、HTML
</a></li><li class="dropdown-item"><!----> <a href="/javaweb/css/" class="nav-link">
  2、CSS
</a></li><li class="dropdown-item"><!----> <a href="/javaweb/js/" class="nav-link">
  3、JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/javaweb/web/" class="nav-link">
  4、Web
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cli/log/" class="nav-link">
  1、日志框架
</a></li><li class="dropdown-item"><!----> <a href="/cli/maven/" class="nav-link">
  2、Maven
</a></li><li class="dropdown-item"><!----> <a href="/cli/design/" class="nav-link">
  3、设计模式
</a></li><li class="dropdown-item"><!----> <a href="/cli/mybatis/" class="nav-link">
  4、Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/cli/spring/" class="nav-link">
  5、Spring
</a></li><li class="dropdown-item"><!----> <a href="/cli/springmvc/" class="nav-link">
  6、SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/cli/mybatisplus/" class="nav-link">
  7、MybatisPlus
</a></li><li class="dropdown-item"><!----> <a href="/cli/redis/" class="nav-link">
  8、Redis
</a></li><li class="dropdown-item"><!----> <a href="/cli/ssmproject/" class="nav-link">
  9、SSM小项目
</a></li><li class="dropdown-item"><!----> <a href="/cli/springboot/" class="nav-link">
  10、SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/cli/springdata-jpa/" class="nav-link router-link-active">
  11、Springdata-jpa
</a></li><li class="dropdown-item"><!----> <a href="/cli/springsecurity/" class="nav-link">
  12、SpringSecurity
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式及组件" class="dropdown-title"><span class="title">分布式及组件</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式及组件" class="mobile-dropdown-title"><span class="title">分布式及组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/nginx/" class="nav-link">
  1、Nginx
</a></li><li class="dropdown-item"><!----> <a href="/cloud/springcloud/" class="nav-link">
  2、SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/cloud/springcloudalibaba/" class="nav-link">
  3、SpringCloudAlibaba
</a></li><li class="dropdown-item"><!----> <a href="/cloud/elk1/" class="nav-link">
  4、Elk(上)
</a></li><li class="dropdown-item"><!----> <a href="/cloud/elk2/" class="nav-link">
  5、Elk(下)
</a></li><li class="dropdown-item"><!----> <a href="/cloud/rocketmq/" class="nav-link">
  6、RocketMQ
</a></li><li class="dropdown-item"><!----> <a href="/cloud/rabbitmq/" class="nav-link">
  7、RabbitMQ
</a></li><li class="dropdown-item"><!----> <a href="/cloud/docker/" class="nav-link">
  8、Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><span class="title">项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="项目" class="mobile-dropdown-title"><span class="title">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/project/msg/" class="nav-link">
  1、短信调度
</a></li><li class="dropdown-item"><!----> <a href="/project/buy1/" class="nav-link">
  2、二手交易网(上)
</a></li><li class="dropdown-item"><!----> <a href="/project/buy2/" class="nav-link">
  3、二手交易网(中)
</a></li><li class="dropdown-item"><!----> <a href="/project/buy3/" class="nav-link">
  4、二手交易网(下)
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/calculate/sort/" class="nav-link">
  1、排序
</a></li><li class="dropdown-item"><!----> <a href="/calculate/count/" class="nav-link">
  2、必会算法
</a></li></ul></div></div><div class="nav-item"><a href="/thanks/" class="nav-link">
  鸣谢
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/ahead/" class="nav-link">
  学习路线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><span class="title">Java基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java基础" class="mobile-dropdown-title"><span class="title">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/chick/" class="nav-link">
  1、纯基础
</a></li><li class="dropdown-item"><!----> <a href="/base/fengzhuang/" class="nav-link">
  2、面向对象之封装
</a></li><li class="dropdown-item"><!----> <a href="/base/extends/" class="nav-link">
  3、面向对象之继承
</a></li><li class="dropdown-item"><!----> <a href="/base/duotai/" class="nav-link">
  4、面向对象之多态
</a></li><li class="dropdown-item"><!----> <a href="/base/other/" class="nav-link">
  5、面向对象其他知识
</a></li><li class="dropdown-item"><!----> <a href="/base/jvm/" class="nav-link">
  6、jvm
</a></li><li class="dropdown-item"><!----> <a href="/base/api/" class="nav-link">
  7、常用api
</a></li><li class="dropdown-item"><!----> <a href="/base/exception/" class="nav-link">
  8、异常处理
</a></li><li class="dropdown-item"><!----> <a href="/base/fanxing/" class="nav-link">
  9、泛型
</a></li><li class="dropdown-item"><!----> <a href="/base/enum/" class="nav-link">
  9、枚举
</a></li><li class="dropdown-item"><!----> <a href="/base/thread/" class="nav-link">
  10、多线程
</a></li><li class="dropdown-item"><!----> <a href="/base/tree/" class="nav-link">
  11、树
</a></li><li class="dropdown-item"><!----> <a href="/base/collection/" class="nav-link">
  12、集合
</a></li><li class="dropdown-item"><!----> <a href="/base/io/" class="nav-link">
  13、IO流
</a></li><li class="dropdown-item"><!----> <a href="/base/reflect/" class="nav-link">
  14、反射
</a></li><li class="dropdown-item"><!----> <a href="/base/socket/" class="nav-link">
  15、网络编程
</a></li><li class="dropdown-item"><!----> <a href="/base/nio/" class="nav-link">
  16、NIO
</a></li><li class="dropdown-item"><!----> <a href="/base/express/" class="nav-link">
  17、正则表达式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="必会工具系统" class="dropdown-title"><span class="title">必会工具系统</span> <span class="arrow down"></span></button> <button type="button" aria-label="必会工具系统" class="mobile-dropdown-title"><span class="title">必会工具系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/linux/" class="nav-link">
  1、Linux
</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">
  2、Git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/chick/" class="nav-link">
  1、MySql入门
</a></li><li class="dropdown-item"><!----> <a href="/database/god/" class="nav-link">
  2、MySql进阶
</a></li><li class="dropdown-item"><!----> <a href="/database/jdbc/" class="nav-link">
  3、JDBC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaWeb" class="dropdown-title"><span class="title">JavaWeb</span> <span class="arrow down"></span></button> <button type="button" aria-label="JavaWeb" class="mobile-dropdown-title"><span class="title">JavaWeb</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javaweb/html/" class="nav-link">
  1、HTML
</a></li><li class="dropdown-item"><!----> <a href="/javaweb/css/" class="nav-link">
  2、CSS
</a></li><li class="dropdown-item"><!----> <a href="/javaweb/js/" class="nav-link">
  3、JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/javaweb/web/" class="nav-link">
  4、Web
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架" class="mobile-dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cli/log/" class="nav-link">
  1、日志框架
</a></li><li class="dropdown-item"><!----> <a href="/cli/maven/" class="nav-link">
  2、Maven
</a></li><li class="dropdown-item"><!----> <a href="/cli/design/" class="nav-link">
  3、设计模式
</a></li><li class="dropdown-item"><!----> <a href="/cli/mybatis/" class="nav-link">
  4、Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/cli/spring/" class="nav-link">
  5、Spring
</a></li><li class="dropdown-item"><!----> <a href="/cli/springmvc/" class="nav-link">
  6、SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/cli/mybatisplus/" class="nav-link">
  7、MybatisPlus
</a></li><li class="dropdown-item"><!----> <a href="/cli/redis/" class="nav-link">
  8、Redis
</a></li><li class="dropdown-item"><!----> <a href="/cli/ssmproject/" class="nav-link">
  9、SSM小项目
</a></li><li class="dropdown-item"><!----> <a href="/cli/springboot/" class="nav-link">
  10、SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/cli/springdata-jpa/" class="nav-link router-link-active">
  11、Springdata-jpa
</a></li><li class="dropdown-item"><!----> <a href="/cli/springsecurity/" class="nav-link">
  12、SpringSecurity
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式及组件" class="dropdown-title"><span class="title">分布式及组件</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式及组件" class="mobile-dropdown-title"><span class="title">分布式及组件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cloud/nginx/" class="nav-link">
  1、Nginx
</a></li><li class="dropdown-item"><!----> <a href="/cloud/springcloud/" class="nav-link">
  2、SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/cloud/springcloudalibaba/" class="nav-link">
  3、SpringCloudAlibaba
</a></li><li class="dropdown-item"><!----> <a href="/cloud/elk1/" class="nav-link">
  4、Elk(上)
</a></li><li class="dropdown-item"><!----> <a href="/cloud/elk2/" class="nav-link">
  5、Elk(下)
</a></li><li class="dropdown-item"><!----> <a href="/cloud/rocketmq/" class="nav-link">
  6、RocketMQ
</a></li><li class="dropdown-item"><!----> <a href="/cloud/rabbitmq/" class="nav-link">
  7、RabbitMQ
</a></li><li class="dropdown-item"><!----> <a href="/cloud/docker/" class="nav-link">
  8、Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><span class="title">项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="项目" class="mobile-dropdown-title"><span class="title">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/project/msg/" class="nav-link">
  1、短信调度
</a></li><li class="dropdown-item"><!----> <a href="/project/buy1/" class="nav-link">
  2、二手交易网(上)
</a></li><li class="dropdown-item"><!----> <a href="/project/buy2/" class="nav-link">
  3、二手交易网(中)
</a></li><li class="dropdown-item"><!----> <a href="/project/buy3/" class="nav-link">
  4、二手交易网(下)
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/calculate/sort/" class="nav-link">
  1、排序
</a></li><li class="dropdown-item"><!----> <a href="/calculate/count/" class="nav-link">
  2、必会算法
</a></li></ul></div></div><div class="nav-item"><a href="/thanks/" class="nav-link">
  鸣谢
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>框架篇</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cli/spring/notes/spring.html" class="sidebar-link">spring</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-data-jpa"><a href="#spring-data-jpa" class="header-anchor">#</a> SPRING-DATA-JPA</h1> <p>为什么出这个课程：中小企业当中，老代码，jpa</p> <p>若依、eladmin二次开发的框架，jpa</p> <p>jpa场景：国外软件，jpa使用量，大于国内mybatis。</p> <h2 id="第一章-orm概述-了解"><a href="#第一章-orm概述-了解" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E7%AC%AC%E4%B8%80%E7%AB%A0-orm%E6%A6%82%E8%BF%B0-%E4%BA%86%E8%A7%A3" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>第一章 ORM概述-了解</h2> <p>ORM（Object-Relational Mapping） 表示对象关系映射。在面向对象的软件开发中，通过ORM，就可以把对象映射到关系型数据库中。只要有一套程序能够做到建立对象与数据库的关联，操作对象就可以直接操作数据库数据，就可以说这套程序实现了ORM对象关系映射</p> <p>简单的说：ORM就是建立实体类和数据库表之间的关系，从而达到操作实体类就相当于操作数据库表的目的。</p> <h3 id="一、为什么使用orm"><a href="#一、为什么使用orm" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E4%B8%80%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8orm" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>一、为什么使用ORM</h3> <p>当实现一个应用程序时（不使用O/R Mapping），我们可能会写特别多数据访问层的代码，从数据库保存数据、修改数据、删除数据，而这些代码都是重复的。而使用ORM则会大大减少重复性代码。对象关系映射（Object Relational Mapping，简称ORM），主要实现程序对象到关系数据库数据的映射。</p> <h3 id="二、常见orm框架"><a href="#二、常见orm框架" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E4%BA%8C%E3%80%81%E5%B8%B8%E8%A7%81orm%E6%A1%86%E6%9E%B6" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>二、常见ORM框架</h3> <p>常见的orm框架：Mybatis（ibatis）、Hibernate、Jpa</p> <h2 id="第二章-hibernate与jpa的概述-了解"><a href="#第二章-hibernate与jpa的概述-了解" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E7%AC%AC%E4%BA%8C%E7%AB%A0-hibernate%E4%B8%8Ejpa%E7%9A%84%E6%A6%82%E8%BF%B0-%E4%BA%86%E8%A7%A3" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>第二章 hibernate与JPA的概述-了解</h2> <h3 id="一、hibernate概述"><a href="#一、hibernate概述" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E4%B8%80%E3%80%81hibernate%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>一、hibernate概述</h3> <p>Hibernate是一个开放源代码的对象关系映射框架，它对JDBC进行了非常轻量级的对象封装，它将POJO与数据库表建立映射关系，是一个全自动的orm框架，hibernate可以自动生成SQL语句，自动执行，使得Java程序员可以随心所欲的使用对象编程思维来操纵数据库。</p> <h3 id="二、-jpa概述"><a href="#二、-jpa概述" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E4%BA%8C%E3%80%81-jpa%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>二、 JPA概述</h3> <p>JAVA的全称是Java Persistence API， 即Java 持久化API，是SUN公司推出的一套基于ORM的规范，内部是由一系列的接口和抽象类构成。</p> <p>JPA通过JDK 5.0注解描述对象－关系表的映射关系，并将运行期的实体对象持久化到数据库中。</p> <h3 id="三、jpa的优势"><a href="#三、jpa的优势" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E4%B8%89%E3%80%81jpa%E7%9A%84%E4%BC%98%E5%8A%BF" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>三、JPA的优势</h3> <h4 id="_1-标准化"><a href="#_1-标准化" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#_1-%E6%A0%87%E5%87%86%E5%8C%96" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><strong>1. 标准化</strong></h4> <p>JPA 是 JCP 组织发布的 Java EE 标准之一，因此任何声称符合 JPA 标准的框架都遵循同样的架构，提供相同的访问API，这保证了基于JPA开发的企业应用能够经过少量的修改就能够在不同的JPA框架下运行。</p> <h4 id="_2-容器级特性的支持"><a href="#_2-容器级特性的支持" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#_2-%E5%AE%B9%E5%99%A8%E7%BA%A7%E7%89%B9%E6%80%A7%E7%9A%84%E6%94%AF%E6%8C%81" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><strong>2. 容器级特性的支持</strong></h4> <p>JPA框架中支持大数据集、事务、并发等容器级事务，这使得 JPA 超越了简单持久化框架的局限，在企业应用发挥更大的作用。</p> <h4 id="_3-简单方便"><a href="#_3-简单方便" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#_3-%E7%AE%80%E5%8D%95%E6%96%B9%E4%BE%BF" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><strong>3. 简单方便</strong></h4> <p>JPA的主要目标之一就是提供更加简单的编程模型：在JPA框架下创建实体和创建Java 类一样简单，没有任何的约束和限制，只需要使用 javax.persistence.Entity进行注释，JPA的框架和接口也都非常简单，没有太多特别的规则和设计模式的要求，开发者可以很容易的掌握。JPA基于非侵入式原则设计，因此可以很容易的和其它框架或者容器集成。</p> <h4 id="_4-查询能力"><a href="#_4-查询能力" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#_4-%E6%9F%A5%E8%AF%A2%E8%83%BD%E5%8A%9B" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><strong>4. 查询能力</strong></h4> <p>JPA的查询语言是面向对象而非面向数据库的，它以面向对象的自然语法构造查询语句，可以看成是Hibernate HQL的等价物。JPA定义了独特的JPQL（Java Persistence Query Language），JPQL是EJB QL的一种扩展，它是针对实体的一种查询语言，操作对象是实体，而不是关系数据库的表，而且能够支持批量更新和修改、JOIN、GROUP BY、HAVING 等通常只有 SQL 才能够提供的高级查询特性，甚至还能够支持子查询。</p> <h4 id="_5-高级特性"><a href="#_5-高级特性" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#_5-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><strong>5. 高级特性</strong></h4> <p>JPA 中能够支持面向对象的高级特性，如类之间的继承、多态和类之间的复杂关系，这样的支持能够让开发者最大限度的使用<strong>面向对象</strong>的模型设计企业应用，而不需要自行处理这些特性在关系数据库的持久化。</p> <h3 id="四、-jpa与hibernate的关系"><a href="#四、-jpa与hibernate的关系" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E5%9B%9B%E3%80%81-jpa%E4%B8%8Ehibernate%E7%9A%84%E5%85%B3%E7%B3%BB" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><strong>四、</strong> JPA与hibernate的关系</h3> <p>JPA规范本质上就是一种ORM规范，注意不是ORM框架——因为JPA并未提供ORM实现，它只是制订了一些规范，提供了一些编程的API接口，但具体实现则由服务厂商来提供实现。</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220807233843298.065a96af.png" alt="image-20220807233843298"></p> <p>JPA和Hibernate的关系就像JDBC和JDBC驱动的关系，JPA是规范，Hibernate除了作为ORM框架之外，它也是一种JPA实现。JPA怎么取代Hibernate呢？JDBC规范可以驱动底层数据库吗？答案是否定的，也就是说，如果使用JPA规范进行数据库操作，底层需要hibernate作为其实现类完成数据持久化工作。</p> <h2 id="第三章-jpa的入门案例"><a href="#第三章-jpa的入门案例" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E7%AC%AC%E4%B8%89%E7%AB%A0-jpa%E7%9A%84%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>第三章 JPA的入门案例</h2> <p>新建maven boot项目</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808000147721.d789ed9d.png" alt="image-20220808000147721"></p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808000234306.69e01cb1.png" alt="image-20220808000234306"></p> <h3 id="一、配置数据源"><a href="#一、配置数据源" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E4%B8%80%E3%80%81%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>一、配置数据源</h3> <p>这里用的yml方式,里面的jpa就是数据库的名称,大家也可以写其他的,前提是这个数据库存在,用户名和密码写自己的就好。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/jpa<span class="token punctuation">?</span>serverTimezone=UTC
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> ydlclass666
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>1
2
3
4
5
6
7</p> <h3 id="二、导入依赖"><a href="#二、导入依赖" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E4%BA%8C%E3%80%81%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>二、导入依赖</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>1
2
3
4
5
6
7
8
9</p> <h3 id="三、创建实体类"><a href="#三、创建实体类" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E4%B8%89%E3%80%81%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>三、创建实体类</h3> <p>通过注解方式让数据库知道我们的表长什么样</p> <p>这里就可以知道表的名称是users(当然你可以任意取名),表的创建一般都有主键和自增操作,这里全部通过注解来完成。这里第一次创建表的时候表名会爆红,我们需要给他手动指定数据库,也就是数据源配置时的数据库</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>ydljpa<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Created by IT李老师
 * 公主号 “元动力课堂”
 * 个人微 itlils
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span> <span class="token comment">//这是实体类</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span> <span class="token comment">//对应哪张表</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span> <span class="token comment">//这是主键</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token comment">//数据库中的id,对应属性中的id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span> <span class="token comment">//</span>
    <span class="token keyword">int</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token comment">//数据库中的username,对应属性中的username</span>
    <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token comment">//数据库中的password,对应属性中的password</span>
    <span class="token class-name">String</span> password<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</p> <p>这里我们还需要设置自动表定义ddl-auto</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#显示sql</span>
    <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
      <span class="token key atrule">ddl-auto</span><span class="token punctuation">:</span> create <span class="token comment">#自动生成表</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>1
2
3
4
5</p> <p>ddl-auto属性用于设置自动表定义，可以实现自动在数据库中为我们创建一个表，表的结构会根据我们定义的实体类决定，它有4种</p> <ul><li>create 启动时删数据库中的表，然后创建，退出时不删除数据表</li> <li>create-drop 启动时删数据库中的表，然后创建，退出时删除数据表 如果表不存在报错</li> <li>update 如果启动时表格式不一致则更新表，原有数据保留</li> <li>validate 项目启动表结构进行校验 如果不一致则报错</li></ul> <h3 id="四、启动测试类完成表创建"><a href="#四、启动测试类完成表创建" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E5%9B%9B%E3%80%81%E5%90%AF%E5%8A%A8%E6%B5%8B%E8%AF%95%E7%B1%BB%E5%AE%8C%E6%88%90%E8%A1%A8%E5%88%9B%E5%BB%BA" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>四、启动测试类完成表创建</h3> <p>这时候可以看到控制台打印这两句话,就会发现表已经创建成功了(和我们自己去敲命令行十分类似,hibernate帮我们完成这些操作,是不是很方便) 删表是因为选择了create策略创建表,后面还会讲其他的策略。 <img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808002349223.4b9fae29.png" alt="image-20220808002349223"></p> <p>我们可以添加一条记录测试一下表 发现没有问题</p> <p><img src="data:image/png;base64,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" alt="image-20220808002952122"></p> <h3 id="五、如何访问我们的表"><a href="#五、如何访问我们的表" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E4%BA%94%E3%80%81%E5%A6%82%E4%BD%95%E8%AE%BF%E9%97%AE%E6%88%91%E4%BB%AC%E7%9A%84%E8%A1%A8" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>五、如何访问我们的表</h3> <p>这里我们需要自定义借口继承接口JpaRepository</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>1
2
3</p> <p>注意JpaRepository有两个泛型，前者是具体操作的对象实体，也就是对应的表，后者是ID的类型，接口中已经定义了比较常用的数据库操作。编写接口继承即可，我们可以直接注入此接口获得实现类： 这是查操作</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>ydljpa</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>ydljpa<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">UserRepository</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">YdljpaApplicationTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        userRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808003340788.fad30c9b.png" alt="image-20220808003340788"> 这里需要注意把create策略改成update,因为create策略会删表中数据</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808004442911.8c3db270.png" alt="image-20220808004442911"></p> <p>这是增操作</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">User</span> user<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//user.setId(2);</span>
        user<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;itnanls&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;ydl666&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">User</span> saveUser <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//新增 返回的实体中带着实体id</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>saveUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>1
2
3
4
5
6
7
8
9
10</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808003840259.412299c2.png" alt="image-20220808003840259"></p> <p>这是删操作</p> <p>这是删操作</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        userRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>1
2
3
4</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808003949975.6b8f31df.png" alt="image-20220808003949975"></p> <p>这是分页操作 每页只显示一个数据 ,大家可以先多添加几条记录后再来测试</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPageable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        userRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>1
2
3
4</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808004236628.1258db66.png" alt="image-20220808004236628"></p> <p>自带的方法肯定不止这几个,这里就是一一举例。</p> <p>自带的方法肯定不止这几个,这里就是一一举例。</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808004306106.e02efb78.png" alt="image-20220808004306106"></p> <h2 id="第四章-方法命名规则查询"><a href="#第四章-方法命名规则查询" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E6%96%B9%E6%B3%95%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99%E6%9F%A5%E8%AF%A2" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>第四章 方法命名规则查询</h2> <p>顾名思义，方法命名规则查询就是根据方法的名字，就能创建查询。只需要按照Spring Data JPA提供的方法命名规则定义方法的名称，就可以完成查询工作。Spring Data JPA在程序执行的时候会根据方法名称进行解析，并自动生成查询语句进行查询.</p> <p>按照Spring Data JPA 定义的规则，查询方法以findBy开头，涉及条件查询时，条件的属性用条件关键字连接，要注意的是：条件属性首字母需大写。框架在进行方法名解析时，会先把方法名多余的前缀截取掉，然后对剩下部分进行解析。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//根据username查询</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>1
2</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808013823671.7c5d1dc4.png" alt="image-20220808013823671"></p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>List&amp;lt;User&gt; findByUsernameAndPassword(String username,String password);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>1</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808014059171.0db17c68.png" alt="image-20220808014059171"></p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>List&amp;lt;User&gt; findByUsernameLike(String username);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>1</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808014320185.5a6c675b.png" alt="image-20220808014320185"></p> <p>具体的关键字，使用方法和生产成SQL如下表所示</p> <table><thead><tr><th>Keyword</th> <th>Sample</th> <th>JPQL</th></tr></thead> <tbody><tr><td>And</td> <td>findByLastnameAndFirstname</td> <td>… where x.lastname = ?1 and x.firstname = ?2</td></tr> <tr><td>Or</td> <td>findByLastnameOrFirstname</td> <td>… where x.lastname = ?1 or x.firstname = ?2</td></tr> <tr><td>Is,Equals</td> <td>findByFirstnameIs,findByFirstnameEquals</td> <td>… where x.firstname = ?1</td></tr> <tr><td>Between</td> <td>findByStartDateBetween</td> <td>… where x.startDate between ?1 and ?2</td></tr> <tr><td>LessThan</td> <td>findByAgeLessThan</td> <td>… where x.age &lt; ?1</td></tr> <tr><td>LessThanEqual</td> <td>findByAgeLessThanEqual</td> <td>… where x.age ⇐ ?1</td></tr> <tr><td>GreaterThan</td> <td>findByAgeGreaterThan</td> <td>… where x.age &gt; ?1</td></tr> <tr><td>GreaterThanEqual</td> <td>findByAgeGreaterThanEqual</td> <td>… where x.age &gt;= ?1</td></tr> <tr><td>After</td> <td>findByStartDateAfter</td> <td>… where x.startDate &gt; ?1</td></tr> <tr><td>Before</td> <td>findByStartDateBefore</td> <td>… where x.startDate &lt; ?1</td></tr> <tr><td>IsNull</td> <td>findByAgeIsNull</td> <td>… where x.age is null</td></tr> <tr><td>IsNotNull,NotNull</td> <td>findByAge(Is)NotNull</td> <td>… where x.age not null</td></tr> <tr><td>Like</td> <td>findByFirstnameLike</td> <td>… where x.firstname like ?1</td></tr> <tr><td>NotLike</td> <td>findByFirstnameNotLike</td> <td>… where x.firstname not like ?1</td></tr> <tr><td>StartingWith</td> <td>findByFirstnameStartingWith</td> <td>… where x.firstname like ?1 (parameter bound with appended %)</td></tr> <tr><td>EndingWith</td> <td>findByFirstnameEndingWith</td> <td>… where x.firstname like ?1 (parameter bound with prepended %)</td></tr> <tr><td>Containing</td> <td>findByFirstnameContaining</td> <td>… where x.firstname like ?1 (parameter bound wrapped in %)</td></tr> <tr><td>OrderBy</td> <td>findByAgeOrderByLastnameDesc</td> <td>… where x.age = ?1 order by x.lastname desc</td></tr> <tr><td>Not</td> <td>findByLastnameNot</td> <td>… where x.lastname &lt;&gt; ?1</td></tr> <tr><td>In</td> <td>findByAgeIn(Collection ages)</td> <td>… where x.age in ?1</td></tr> <tr><td>NotIn</td> <td>findByAgeNotIn(Collection age)</td> <td>… where x.age not in ?1</td></tr> <tr><td>TRUE</td> <td>findByActiveTrue()</td> <td>… where x.active = true</td></tr> <tr><td>FALSE</td> <td>findByActiveFalse()</td> <td>… where x.active = false</td></tr> <tr><td>IgnoreCase</td> <td>findByFirstnameIgnoreCase</td> <td>… where UPPER(x.firstame) = UPPER(?1)</td></tr></tbody></table> <h2 id="第五章-使用jpql的方式查询"><a href="#第五章-使用jpql的方式查询" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E4%BD%BF%E7%94%A8jpql%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9F%A5%E8%AF%A2" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>第五章 使用JPQL的方式查询</h2> <p>使用Spring Data JPA提供的查询方法已经可以解决大部分的应用场景，但是对于某些业务来说，我们还需要灵活的构造查询条件，这时就可以使用@Query注解，结合JPQL的语句方式完成查询。</p> <p>@Query 注解的使用非常简单，只需在方法上面标注该注解，同时提供一个JPQL查询语句即可，注意：</p> <ul><li>大多数情况下将*替换为别名</li> <li>表名改为类名</li> <li>字段名改为属性名</li> <li>搭配注解@Query进行使用</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select 表别名 from 表名(实际为类名) 别名 where 别名.属性='itlils'&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>1
2</p> <h3 id="一、入门"><a href="#一、入门" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E4%B8%80%E3%80%81%E5%85%A5%E9%97%A8" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>一、入门</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u&quot;</span><span class="token punctuation">)</span><span class="token comment">//从实体类，查询，而不是表</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>1
2</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808021357039.209b2cba.png" alt="image-20220808021357039"></p> <h3 id="二、筛选条件"><a href="#二、筛选条件" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E4%BA%8C%E3%80%81%E7%AD%9B%E9%80%89%E6%9D%A1%E4%BB%B6" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>二、筛选条件</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u where u.username='itlils'&quot;</span><span class="token punctuation">)</span><span class="token comment">//从实体类，查询，而不是表。where不是列名，而是属性名</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllUserByUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>1
2</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808021559832.2ee553c4.png" alt="image-20220808021559832"></p> <h3 id="三、投影结果"><a href="#三、投影结果" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E4%B8%89%E3%80%81%E6%8A%95%E5%BD%B1%E7%BB%93%E6%9E%9C" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>三、投影结果</h3> <p>真实的业务当中，我们只想要表里某一些列。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u.id from User u&quot;</span><span class="token punctuation">)</span><span class="token comment">//从实体类，查询，而不是表</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllUser2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>1
2</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808021946929.9949c62d.png" alt="image-20220808021946929"></p> <h3 id="四、聚合查询"><a href="#四、聚合查询" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E5%9B%9B%E3%80%81%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>四、聚合查询</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select count(u) from User u&quot;</span><span class="token punctuation">)</span><span class="token comment">//从实体类，查询，而不是表</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllUser4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>1
2</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808022257969.dc5d8449.png" alt="image-20220808022257969"></p> <h3 id="五、传参"><a href="#五、传参" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E4%BA%94%E3%80%81%E4%BC%A0%E5%8F%82" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>五、传参</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">//修改数据 一定加上@Modifying 注解</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token annotation punctuation">@Modifying</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;update User set username=?1 where id=?2&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">int</span> <span class="token function">updateUsernameById2</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>1
2
3
4
5</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808022944792.ac091f3e.png" alt="image-20220808022944792"></p> <h2 id="第六章-使用原生sql"><a href="#第六章-使用原生sql" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E7%AC%AC%E5%85%AD%E7%AB%A0-%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9Fsql" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>第六章 使用原生sql</h2> <p>nativeQuery = true</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">//修改数据 一定加上@Modifying 注解</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token annotation punctuation">@Modifying</span>
    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;update user u set u.username=?1 where u.id=?2&quot;</span><span class="token punctuation">,</span>nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">int</span> <span class="token function">updateUsernameById3</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>1
2
3
4
5</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808023202904.f6eb68a6.png" alt="image-20220808023202904"></p> <p>其他就和mybatis一样使用了</p> <h2 id="第七章-一对一关系"><a href="#第七章-一对一关系" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E7%AC%AC%E4%B8%83%E7%AB%A0-%E4%B8%80%E5%AF%B9%E4%B8%80%E5%85%B3%E7%B3%BB" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>第七章 一对一关系</h2> <p>账户和账户明细</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808030240590.539bdc57.png" alt="image-20220808030240590"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>   <span class="token comment">//表示这个类是一个实体类</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;account&quot;</span><span class="token punctuation">)</span>    <span class="token comment">//对应的数据库中表名称</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>   <span class="token comment">//生成策略，这里配置为自增</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>    <span class="token comment">//对应表中id这一列</span>
    <span class="token annotation punctuation">@Id</span>     <span class="token comment">//此属性为主键</span>
    <span class="token keyword">int</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>   <span class="token comment">//对应表中username这一列</span>
    <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span>   <span class="token comment">//对应表中password这一列</span>
    <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    
    <span class="token comment">//一对一</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;detail_id&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@OneToOne</span><span class="token comment">//声明为一对一关系</span>
    <span class="token class-name">AccountDetail</span> detail<span class="token punctuation">;</span><span class="token comment">//对象类型,也可以理解这里写哪个实体类,外键就指向哪个实体类的主键</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;account_details&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountDetail</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span><span class="token comment">//还是设置一个自增主键</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">int</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;address&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> email<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;phone&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> phone<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;real_name&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> realName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</p> <p>这里从日志中可以看出hibernate帮我们完成外键的创建</p> <p>但这还不能完成同时对两张表进行操作 设置懒加载完成想查什么就查什么功能,设置关联级别完成同时操作两张表</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;detail_id&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span><span class="token constant">LAZY</span><span class="token punctuation">,</span> cascade <span class="token operator">=</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">)</span> <span class="token comment">//设置关联操作为ALL</span>
<span class="token class-name">AccountDetail</span> detail<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>1
2
3</p> <p>这里的关联级别也是有多个,一般设置为all就行</p> <ul><li>ALL：所有操作都进行关联操作</li> <li>PERSIST：插入操作时才进行关联操作</li> <li>REMOVE：删除操作时才进行关联操作</li> <li>MERGE：修改操作时才进行关联操作</li></ul> <p>测试：运行测试类任意方法，边创建完成</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808031126088.cd3ecb19.png" alt="image-20220808031126088"></p> <p>现在我们就可以同时添加数据和删除了</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">AccountRepository</span> accountRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFind11</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Account</span> account<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;itlils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;ydl666&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">AccountDetail</span> accountDetail<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AccountDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accountDetail<span class="token punctuation">.</span><span class="token function">setPhone</span><span class="token punctuation">(</span><span class="token string">&quot;13000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accountDetail<span class="token punctuation">.</span><span class="token function">setRealName</span><span class="token punctuation">(</span><span class="token string">&quot;itlils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accountDetail<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;cn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accountDetail<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">&quot;123@qq.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        account<span class="token punctuation">.</span><span class="token function">setDetail</span><span class="token punctuation">(</span>accountDetail<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Account</span> save <span class="token operator">=</span> accountRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;插入之后account id为：&quot;</span><span class="token operator">+</span>save<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;|||accountDetail id&quot;</span><span class="token operator">+</span>save<span class="token punctuation">.</span><span class="token function">getDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808031623110.16ebb4ef.png" alt="image-20220808031623110"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFind12</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        accountRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>1
2
3
4</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808031753444.869561f0.png" alt="image-20220808031753444"></p> <p>两表都没了数据</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808031813618.b4fdf42b.png" alt="image-20220808031813618"></p> <h2 id="第八章-对多关系"><a href="#第八章-对多关系" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>第八章 对多关系</h2> <div class="language-text line-numbers-mode"><pre class="language-text"><code>@OneToMany:
   	作用：建立一对多的关系映射
    属性：
    	targetEntityClass：指定多的多方的类的字节码
    	mappedBy：指定从表实体类中引用主表对象的名称。
    	cascade：指定要使用的级联操作
    	fetch：指定是否采用延迟加载
    	orphanRemoval：是否使用孤儿删除
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>1
2
3
4
5
6
7
8</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808033918256.805b5da7.png" alt="image-20220808033918256"></p> <p>实体 Author：作者。</p> <p>实体 Article：文章。</p> <p>Author 和 Article 是一对多关系(双向)。那么在<a href="https://liuyanzhao.com/tag/jpa/" target="_blank" rel="noopener noreferrer">JPAopen in new window<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中，如何表示一对多的双向关联呢？</p> <p><a href="https://liuyanzhao.com/tag/jpa/" target="_blank" rel="noopener noreferrer">JPAopen in new window<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>使用@OneToMany和@ManyToOne来标识一对多的双向关联。一端(Author)使用@OneToMany,多端(Article)使用@ManyToOne。</p> <p>在<a href="https://liuyanzhao.com/tag/jpa/" target="_blank" rel="noopener noreferrer">JPAopen in new window<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>规范中，一对多的双向关系由多端(Article)来维护。就是说多端(Article)为关系维护端，负责关系的增删改查。一端(Author)则为关系被维护端，不能维护关系。</p> <p>一端(Author)使用@OneToMany注释的mappedBy=&quot;author&quot;属性表明Author是关系被维护端。</p> <p>多端(Article)使用@ManyToOne和@JoinColumn来注释属性 author,@ManyToOne表明Article是多端，@JoinColumn设置在article表中的关联字段(外键)。</p> <p>代码：</p> <p>Author</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>ydljpa<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Created by IT李老师
 * 公主号 “元动力课堂”
 * 个人微 itlils
 */</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>   <span class="token comment">//表示这个类是一个实体类</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;author&quot;</span><span class="token punctuation">)</span>    <span class="token comment">//对应的数据库中表名称</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Author</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Id</span> <span class="token comment">// 主键</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span> <span class="token comment">// 自增长策略</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span> <span class="token comment">//id</span>


    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>name <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span class="token comment">//姓名</span>

    <span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;author&quot;</span><span class="token punctuation">,</span>cascade<span class="token operator">=</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">,</span>fetch<span class="token operator">=</span><span class="token class-name">FetchType</span><span class="token punctuation">.</span><span class="token constant">LAZY</span><span class="token punctuation">)</span>
    <span class="token comment">//级联保存、更新、删除、刷新;延迟加载。当删除用户，会级联删除该用户的所有文章</span>
    <span class="token comment">//拥有mappedBy注解的实体类为关系被维护端</span>
    <span class="token comment">//mappedBy=&quot;author&quot;中的author是Article中的author属性</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> articleList<span class="token punctuation">;</span><span class="token comment">//文章列表</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</p> <p>Article</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>ydljpa<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token comment">/**
 * @Created by IT李老师
 * 公主号 “元动力课堂”
 * 个人微 itlils
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>   <span class="token comment">//表示这个类是一个实体类</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;article&quot;</span><span class="token punctuation">)</span>    <span class="token comment">//对应的数据库中表名称</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span> <span class="token comment">// 自增长策略</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token comment">// 映射为字段，值不能为空</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Lob</span>  <span class="token comment">// 大对象，映射 MySQL 的 Long Text 类型</span>
    <span class="token annotation punctuation">@Basic</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span><span class="token constant">LAZY</span><span class="token punctuation">)</span> <span class="token comment">// 懒加载</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// 映射为字段，值不能为空</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span><span class="token comment">//文章全文内容</span>

    <span class="token annotation punctuation">@ManyToOne</span><span class="token punctuation">(</span>cascade<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span><span class="token constant">MERGE</span><span class="token punctuation">,</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span><span class="token constant">REFRESH</span><span class="token punctuation">}</span><span class="token punctuation">,</span>optional<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token comment">//可选属性optional=false,表示author不能为空。删除文章，不影响用户</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;author_id&quot;</span><span class="token punctuation">)</span><span class="token comment">//设置在article表中的关联字段(外键)</span>
    <span class="token keyword">private</span> <span class="token class-name">Author</span> author<span class="token punctuation">;</span><span class="token comment">//所属作者</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</p> <p>测试： 运行，建表</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808034143395.6a29559f.png" alt="image-20220808034143395"></p> <p>新增：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">AuthorRepository</span> authorRepository<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">ArticleRepository</span> articleRepository<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFind13</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Author</span> author<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Author</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        author<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;itlils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Author</span> author1 <span class="token operator">=</span> authorRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>author<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">Article</span> article1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article1<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article1<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article1<span class="token punctuation">.</span><span class="token function">setAuthor</span><span class="token punctuation">(</span>author1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>article1<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">Article</span> article2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article2<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article2<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">&quot;22222&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        article2<span class="token punctuation">.</span><span class="token function">setAuthor</span><span class="token punctuation">(</span>author1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        articleRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>article2<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808034855141.ce3b9000.png" alt="image-20220808034855141"></p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJsAAABBCAYAAADGxNbFAAAEjklEQVR4nO3cvW8jRRgG8Gc4JIsCpUmEKChO4fBpZxvqExVX5BooYAeRNlfeCRokqHYskChoDt2VuX9gRymuOgpa6hTsLAk5i+IqlBRxGZ2QKfwVO7GdXa9fr+3nJ7mwvX49ip7Mx2rG6vz8vI0Vdnp6iq2trUU3gwC8tegG0Ppg2EiMWvVhlKqDPRuJYdhIzNvj3tjY2MhdrNls4r+ND2ZqkLRbrdfY3t5edDMqqdlslvq3Yc9GYhg2EsOwkRiGjcQwbCRmrmF7uVdD/d6POJl4VYan92qo7x3MsylUAXMMW4ZXR/OrTstn7H222QV4/McFHs/vC2jJcM5GYuTnbC92Ud+qDR6Vmqt5WK2gjIO3Gkqp7sPAXXfdmPeduaaGtvDAlLoAvIVW6srnVoFsz/ZiF/WHB9jZv8DxaefxBD/h2d+irZjOGRgkaLfbaLcTRHAwZhALbxtA0u6+nyIOHMxoKC7XSGMEWQOhUggzO7YunIEKHaL0Um00EK5I4ATDdoBvHh5g+7tD/Pr54NUHzw/x6CO5VtxIECOxuvskQhwHgHP9XkjbBP23oWFtBGQZsnE1tIWNOrWSJOrXjSIA3neD5GGtQ5T44dpJjCBzcCuQtjkuEEYcZTgBcKceiH1lYVpDT7nEGQUzNAZGwxdcVyMIEAw9DdDvsryDy4DMKKhrvi/LgKmNqjguEHJzMErBuAhJuzvcJdH0j91Q1B+ehx8lfsXCyIXtboA7AE6Os5E3/sKrqs3ZJnEODgHiNOn3Zd6XMMZ1e8JSalWUYM/2BXY+A5q/7OLppZu9L/d28ZtcI0qSdYY1APAWpjH6D1REZ26YNcLh4dlbaHNlzbqU5OZsAB48vwD2avj2kxqedV/b2T/Eo6OP+88rL0qQxhphb24VxEiTCKGZvbS2Hiku1e7V9yswhmLCgRfu1CXu1KWlxbCRGIaNxDBsJIZhIzFjV6NnZ2fSbaEKKnM1OvY+W5FbGLdar/Hh/puZGiTt/Pv3C93mWQetVqvUehxGSQzDRmIYNhLDsJEYho3E5Apbfas2r3ZUhjMKKmxM3fM/et2051SgZ1u2wOn7t9HeffeGV/vBPrVcin5uvRQaRpcicO9tIv35LtJP87RVI047p6EG2/1728Dzfo5GFZ6zVTlw+v5ttL8GvvrhCObPRbeGemZaIFQ1cP73f6CenBWaL12ea/lG2D9I7Ezn0HDYuL7q9Dlap4fsHT5ekZ3eucy8Gq1q4Mqg47R7mHhw6imNiwyUDkYZZDbtn5aKsvVbPMx8BuH49KKMdqw23znAHASDoEZxvLj2LMhMPRuDdkP6S0Sat0MKh41By6O3WrXQ3iJU6xm6QmFj0ArSMdLeCXpv0VizRULusK1r0LJshn7IN2CurGI19BL87EmZcoVtPYPW+eUhb8OJtz4m0jEiHw5+c81ksGmKQgvbJTZ2W/i/b97JXYw7dVdLq9Uq9W/DXR8khmEjMQwbiWHYSAzDRmJKP6S8ubk5U4OoWspcjZb6+2xEk3AYJTEMG4lh2EgMw0ZiGDYSw7CRGIaNxDBsJOZ/X2u6kFybUVUAAAAASUVORK5CYII=" alt="image-20220808034909693"></p> <p><img src="data:image/png;base64,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" alt="image-20220808034902467"></p> <p>删除：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFind14</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        articleRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>1
2
3
4</p> <p><img src="data:image/png;base64,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" alt="image-20220808035211758"></p> <p>查询：</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>    @Transactional
    @Test
    public void testFind15() {
        Optional&amp;lt;Author&gt; byId = authorRepository.findById(1L);
        if (byId.isPresent()){
            Author author = byId.get();
            List&amp;lt;Article&gt; articleList = author.getArticleList();
            System.out.println(articleList);
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>1
2
3
4
5
6
7
8
9
10</p> <p>1<img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808035632321.2702cec6.png" alt="image-20220808035632321"></p> <p>解决方案：</p> <p>作者 fetch=FetchType.EAGER</p> <p>2、</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808041032681.1efb73a0.png" alt="image-20220808041032681"></p> <p>解决方案：循环tostring 破坏一方的tostring即可。文章@ToString(exclude = {&quot;author&quot;})</p> <p>解决后：</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808041147266.bb1216a1.png" alt="image-20220808041147266"></p> <h2 id="第九章-多对多-关系"><a href="#第九章-多对多-关系" class="header-anchor">#</a> <a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E7%AC%AC%E4%B9%9D%E7%AB%A0-%E5%A4%9A%E5%AF%B9%E5%A4%9A-%E5%85%B3%E7%B3%BB" target="_blank" rel="noopener noreferrer">#<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>第九章 多对多 关系</h2> <p>实体 User：用户。</p> <p>实体 Authority：权限。</p> <p>用户和权限是多对多的关系。一个用户可以有多个权限，一个权限也可以被很多用户拥有。</p> <p><a href="https://liuyanzhao.com/tag/jpa/" target="_blank" rel="noopener noreferrer">JPAopen in new window<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中使用@ManyToMany来注解多对多的关系，由一个关联表来维护。这个关联表的表名默认是：主表名+下划线+从表名。(主表是指关系维护端对应的表,从表指关系被维护端对应的表)。这个关联表只有两个外键字段，分别指向主表ID和从表ID。字段的名称默认为：主表名+下划线+主表中的主键列名，从表名+下划线+从表中的主键列名。</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808041745146.aefc67ff.png" alt="image-20220808041745146"></p> <p>需要注意的：</p> <p>1、多对多关系中一般不设置级联保存、级联删除、级联更新等操作。</p> <p>2、可以随意指定一方为关系维护端，在这个例子中，我指定 User 为关系维护端，所以生成的关联表名称为： user_authority，关联表的字段为：user_id 和 authority_id。</p> <p>3、多对多关系的绑定由关系维护端来完成，即由 User.setAuthorities(authorities) 来绑定多对多的关系。关系被维护端不能绑定关系，即User不能绑定关系。</p> <p>4、多对多关系的解除由关系维护端来完成，即由Authority.getUser().remove(user)来解除多对多的关系。关系被维护端不能解除关系，即Authority不能解除关系。</p> <p>5、如果 User 和 Authority 已经绑定了多对多的关系，那么不能直接删除 Authority，需要由 User 解除关系后，才能删除 Authority。但是可以直接删除 User，因为 User 是关系维护端，删除 User 时，会先解除 User 和 Authority 的关系，再删除 Authority。</p> <p>Users</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>ydljpa<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Created by IT李老师
 * 公主号 “元动力课堂”
 * 个人微 itlils
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span> <span class="token comment">//这是实体类</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span> <span class="token comment">//对应哪张表</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Users</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span> <span class="token comment">// 用户账号，用户登录时的唯一标识</span>


    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>length <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span> <span class="token comment">// 登录时密码</span>

    <span class="token annotation punctuation">@ManyToMany</span>
    <span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_authority&quot;</span><span class="token punctuation">,</span>joinColumns <span class="token operator">=</span> <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            inverseJoinColumns <span class="token operator">=</span> <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;authority_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//1、关系维护端，负责多对多关系的绑定和解除</span>
    <span class="token comment">//2、@JoinTable注解的name属性指定关联表的名字，joinColumns指定外键的名字，关联到关系维护端(User)</span>
    <span class="token comment">//3、inverseJoinColumns指定外键的名字，要关联的关系被维护端(Authority)</span>
    <span class="token comment">//4、其实可以不使用@JoinTable注解，默认生成的关联表名称为主表表名+下划线+从表表名，</span>
    <span class="token comment">//即表名为user_authority</span>
    <span class="token comment">//关联到主表的外键名：主表名+下划线+主表中的主键列名,即user_id</span>
    <span class="token comment">//关联到从表的外键名：主表中用于关联的属性名+下划线+从表的主键列名,即authority_id</span>
    <span class="token comment">//主表就是关系维护端对应的表，从表就是关系被维护端对应的表</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Authority</span><span class="token punctuation">&gt;</span></span> authorityList<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</p> <p>Authority</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ydlclass<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>ydljpa<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Created by IT李老师
 * 公主号 “元动力课堂”
 * 个人微 itlils
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span> <span class="token comment">//这是实体类</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;authority&quot;</span><span class="token punctuation">)</span> <span class="token comment">//对应哪张表</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Authority</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span><span class="token constant">IDENTITY</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span> <span class="token comment">//权限名</span>

    <span class="token annotation punctuation">@ManyToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;authorityList&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Users</span><span class="token punctuation">&gt;</span></span> userList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</p> <p>测试：添加</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UsersRepository</span> usersRepository<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthorityRepository</span> authorityRepository<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFind16</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Authority</span> authority <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Authority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authority<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authority<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;ROLE_ADMIN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorityRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>authority<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFind17</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Users</span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Users</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;itlils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Authority</span> authority <span class="token operator">=</span> authorityRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Authority</span><span class="token punctuation">&gt;</span></span> authorityList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        authorityList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>authority<span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">setAuthorityList</span><span class="token punctuation">(</span>authorityList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        usersRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</p> <p>先运行 saveAuthority 添加一条权限记录，</p> <p>然后运行 saveUser 添加一条用户记录，与此同时，user_authority 表中也自动插入了一条记录</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808042812330.27487702.png" alt="image-20220808042812330"></p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808042832949.2f558552.png" alt="image-20220808042832949"></p> <p>测试 删除</p> <p>删除用户</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFind18</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        usersRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>1
2
3
4</p> <p>user 表中删除一条记录，同时 user_authority 能够级联删除一条记录</p> <p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220808042939402.ec8d4773.png" alt="image-20220808042939402"></p> <p>中间表和users表数据都删除了</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/30/2022, 5:52:54 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a99a21a8.js" defer></script><script src="/assets/js/2.8a7c9856.js" defer></script><script src="/assets/js/66.1e4105ac.js" defer></script>
  </body>
</html>
